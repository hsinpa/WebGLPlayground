function h(i,t,e){return i+e*(t-i)}function o(i,t){return~~(Math.random()*(t-i+1))+i}function l(i){let t=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2));return{x:i.x/t,y:i.y/t}}function c(i,t){return{x:i.x*t,y:i.y*t}}function d(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}function f(i,t){return{x:i.x+t.x,y:i.y+t.y}}var u=class{constructor(t){this._domBody=t,this._domBody.addEventListener("mousemove",this.OnMouseMove.bind(this))}SetConfig(t){console.log("ONLOAD"),this._config=t,this._config.elements.forEach(e=>{e.dom=this._domBody.querySelector(e.id)}),this._recordOffsetX=0,this._recordOffsetY=0,this.StartInverval()}OnMouseMove(t){let e=window.innerWidth,s=window.innerHeight,n=t.clientX/e,r=t.clientY/s;this._targetOffsetX=.5-n,this._targetOffsetY=.5-r}UpdateProcess(){Math.abs(this._targetOffsetX-this._recordOffsetX)+Math.abs(this._recordOffsetY-this._targetOffsetY)<.01||(this._recordOffsetX=h(this._recordOffsetX,this._targetOffsetX,this._config.lerp),this._recordOffsetY=h(this._recordOffsetY,this._targetOffsetY,this._config.lerp),isNaN(this._recordOffsetY)&&(this._recordOffsetY=0),isNaN(this._recordOffsetX)&&(this._recordOffsetX=0),this.Translate(this._recordOffsetX,this._recordOffsetY))}Translate(t,e){this._config.elements.forEach(s=>{let n=t*this._config.strength*s.depth_level,r=e*this._config.strength*s.depth_level,a=`translate(${n}px, ${r}px)`;s.dom!=null&&(s.dom.style.transform=a)})}StartInverval(){this._intervalFunc=setInterval(this.UpdateProcess.bind(this),1e3/60)}Dispose(){this._intervalFunc!=null&&clearInterval(this._intervalFunc)}},p=u;var _=class{constructor(t){this.delta=.02,this._tick=0,this._fps=1e3/60,this.maxBubbleSize=10,this.IsProgramValid=!1,this._canvasDom=t,this.IsProgramValid=this._canvasDom!=null,this.IsProgramValid&&(this._context=this._canvasDom.getContext("2d"),window.addEventListener("resize",()=>{this.SetCanvasSize()}),this.SetCanvasSize())}Play(t,e,s){if(!!this.IsProgramValid){this.bubbles=[],this.speed=e,this.bubbleNum=t,this.SetDireciton(s),this._intervalFunc=setInterval(this.UpdateProcess.bind(this),this._fps);for(let n=0;n<t;n++)this.SpawnBubble(!0)}}SetDireciton(t){this.direction=l(t),this.spawnPosSetting=this.FindStartPos()}Stop(){this._intervalFunc!=null&&clearInterval(this._intervalFunc)}UpdateProcess(){this._context.clearRect(0,0,this._canvasDom.width,this._canvasDom.height),this.ProcessBubbleMoves()}ProcessBubbleMoves(){let t=this.bubbles.length;for(let e=t-1;e>=0;e--)this.DrawBubble(this.bubbles[e]),this.CheckBubbleDistReach(this.bubbles[e])&&this.bubbles.splice(e,1);t<this.bubbleNum&&this.SpawnBubble(),this._tick+=this._fps*.001}SpawnBubble(t=!1){let e={};e.Opacity=o(.1,.7),e.Radius=o(2,this.maxBubbleSize);let s=this.speed*.2;e.SpeedOffset=o(s,s),t||e.Opacity<.2||e.Radius<this.maxBubbleSize*.7?e.StartPoint=this.GetRandomFullScreenPos():e.StartPoint={x:o(this.spawnPosSetting.WidthRange.x,this.spawnPosSetting.WidthRange.y),y:this.spawnPosSetting.StartHeight};let n=this.screenWidth*.2,r=o(e.StartPoint.x-n,e.StartPoint.x+n);e.EndPoint={x:r,y:this.spawnPosSetting.EndHeight},e.CurrentEndPoint=e.EndPoint,e.CurrentPoint=e.StartPoint,e.CurrentOpacity=0,this.bubbles.push(e)}DrawBubble(t){this._context.beginPath();let e=t.EndPoint.x+Math.sin(this._tick+t.SpeedOffset)*1;t.CurrentEndPoint.x=e;let s={x:t.CurrentEndPoint.x-t.CurrentPoint.x,y:t.CurrentEndPoint.y-t.CurrentPoint.y};t.Direction=l(s);let n=c(t.Direction,(t.SpeedOffset+this.speed)*this.delta);t.CurrentPoint=f(t.CurrentPoint,n),t.CurrentOpacity=h(t.CurrentOpacity,t.Opacity,.03);var r=0,a=2*Math.PI,m=!1;this._context.arc(t.CurrentPoint.x,t.CurrentPoint.y,t.Radius,r,a,m),this._context.fillStyle=`rgba(245, 225, 5, ${t.CurrentOpacity})`,this._context.fill()}CheckBubbleDistReach(t){return d(t.CurrentPoint,t.CurrentEndPoint)<10}FindStartPos(){let t={};if(this.direction==null)return t;t.WidthRange={x:-this.maxBubbleSize,y:this.screenWidth+this.maxBubbleSize};let e=this.maxBubbleSize*2;return this.direction.y>0&&(t.StartHeight=this.screenHeight+e,t.EndHeight=-e),this.direction.y<=0&&(t.StartHeight=-e,t.EndHeight=this.screenHeight+e),t}GetRandomFullScreenPos(){return{x:o(0,this.screenWidth),y:o(0,this.screenHeight)}}SetCanvasSize(){this._canvasDom.width=window.innerWidth,this._canvasDom.height=window.innerHeight,this.screenHeight=this._canvasDom.offsetHeight,this.screenWidth=this._canvasDom.offsetWidth,this.spawnPosSetting=this.FindStartPos()}},g=_;window.onload=()=>{let i=new p(document.querySelector("body"));fetch("./Dataset/parallel_setting.json").then(function(e){return e.json()}).then(function(e){i.SetConfig(e)});let t=new g(document.querySelector("#webgl_canvas"));if(t.IsProgramValid){let e=document.querySelector("#particle_count"),s=document.querySelector("#particle_speed"),n=document.querySelector("#particle_d_invert");e.addEventListener("change",a=>{t.bubbleNum=parseInt(a.target.value)}),s.addEventListener("change",a=>{t.speed=parseInt(a.target.value)}),n.addEventListener("change",a=>{t.SetDireciton({x:0,y:n.checked?-1:1})});let r={x:0,y:n.checked?-1:1};t.Play(parseInt(e.value),parseInt(s.value),r)}};
