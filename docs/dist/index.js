var mc=Object.create,Yt=Object.defineProperty,hc=Object.getPrototypeOf,vc=Object.prototype.hasOwnProperty,pc=Object.getOwnPropertyNames,_c=Object.getOwnPropertyDescriptor;var cf=he=>Yt(he,"__esModule",{value:!0});var bc=(he,k)=>()=>(k||(k={exports:{}},he(k.exports,k)),k.exports),yc=(he,k)=>{cf(he);for(var K in k)Yt(he,K,{get:k[K],enumerable:!0})},Ec=(he,k,K)=>{if(cf(he),k&&typeof k=="object"||typeof k=="function")for(let ce of pc(k))!vc.call(he,ce)&&ce!=="default"&&Yt(he,ce,{get:()=>k[ce],enumerable:!(K=_c(k,ce))||K.enumerable});return he},xc=he=>he&&he.__esModule?he:Ec(Yt(he!=null?mc(hc(he)):{},"default",{value:he,enumerable:!0}),he);var Tf=bc(Ac=>{yc(Ac,{default:()=>Lc});var Tc=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function gc(he,k,K){return K={path:k,exports:{},require:function(ce,ge){return Sc(ce,ge==null?K.path:ge)}},he(K,K.exports),K.exports}function Sc(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var wc=gc(function(he,k){(function(K,ce){he.exports=ce()})(Tc,function(){var K=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},ce=function(e,n){for(var s=Object.keys(n),x=0;x<s.length;++x)e[s[x]]=n[s[x]];return e},ge=`
`;function Ve(e){return typeof atob!="undefined"?atob(e):"base64:"+e}function Pe(e){var n=new Error("(regl) "+e);throw console.error(n),n}function Se(e,n){e||Pe(n)}function sr(e){return e?": "+e:""}function Fr(e,n,s){e in n||Pe("unknown parameter ("+e+")"+sr(s)+". possible values: "+Object.keys(n).join())}function wf(e,n){K(e)||Pe("invalid parameter type"+sr(n)+". must be a typed array")}function Kn(e,n){switch(n){case"number":return typeof e=="number";case"object":return typeof e=="object";case"string":return typeof e=="string";case"boolean":return typeof e=="boolean";case"function":return typeof e=="function";case"undefined":return typeof e=="undefined";case"symbol":return typeof e=="symbol"}}function Lf(e,n,s){Kn(e,n)||Pe("invalid parameter type"+sr(s)+". expected "+n+", got "+typeof e)}function Of(e,n){e>=0&&(e|0)===e||Pe("invalid parameter type, ("+e+")"+sr(n)+". must be a nonnegative integer")}function qt(e,n,s){n.indexOf(e)<0&&Pe("invalid value"+sr(s)+". must be one of: "+n)}var Zn=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Rf(e){Object.keys(e).forEach(function(n){Zn.indexOf(n)<0&&Pe('invalid regl constructor argument "'+n+'". must be one of '+Zn)})}function Pr(e,n){for(e=e+"";e.length<n;)e=" "+e;return e}function Qt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Jn(e,n){this.number=e,this.line=n,this.errors=[]}function ea(e,n,s){this.file=e,this.line=n,this.message=s}function yr(){var e=new Error,n=(e.stack||e).toString(),s=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(n);if(s)return s[1];var x=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(n);return x?x[1]:"unknown"}function ra(){var e=new Error,n=(e.stack||e).toString(),s=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(n);if(s)return s[1];var x=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(n);return x?x[1]:"unknown"}function Kt(e,n){var s=e.split(`
`),x=1,w=0,E={unknown:new Qt,0:new Qt};E.unknown.name=E[0].name=n||yr(),E.unknown.lines.push(new Jn(0,""));for(var S=0;S<s.length;++S){var G=s[S],C=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(G);if(C)switch(C[1]){case"line":var B=/(\d+)(\s+\d+)?/.exec(C[2]);B&&(x=B[1]|0,B[2]&&(w=B[2]|0,w in E||(E[w]=new Qt)));break;case"define":var M=/SHADER_NAME(_B64)?\s+(.*)$/.exec(C[2]);M&&(E[w].name=M[1]?Ve(M[2]):M[2]);break}E[w].lines.push(new Jn(x++,G))}return Object.keys(E).forEach(function(I){var j=E[I];j.lines.forEach(function(D){j.index[D.number]=D})}),E}function Cf(e){var n=[];return e.split(`
`).forEach(function(s){if(!(s.length<5)){var x=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(s);x?n.push(new ea(x[1]|0,x[2]|0,x[3].trim())):s.length>0&&n.push(new ea("unknown",0,s))}}),n}function Gf(e,n){n.forEach(function(s){var x=e[s.file];if(x){var w=x.index[s.line];if(w){w.errors.push(s),x.hasErrors=!0;return}}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(s)})}function Df(e,n,s,x,w){if(!e.getShaderParameter(n,e.COMPILE_STATUS)){var E=e.getShaderInfoLog(n),S=x===e.FRAGMENT_SHADER?"fragment":"vertex";na(s,"string",S+" shader source must be a string",w);var G=Kt(s,w),C=Cf(E);Gf(G,C),Object.keys(G).forEach(function(B){var M=G[B];if(!M.hasErrors)return;var I=[""],j=[""];function D(N,v){I.push(N),j.push(v||"")}D("file number "+B+": "+M.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),M.lines.forEach(function(N){if(N.errors.length>0){D(Pr(N.number,4)+"|  ","background-color:yellow; font-weight:bold"),D(N.line+ge,"color:red; background-color:yellow; font-weight:bold");var v=0;N.errors.forEach(function(T){var P=T.message,ee=/^\s*'(.*)'\s*:\s*(.*)$/.exec(P);if(ee){var O=ee[1];switch(P=ee[2],O){case"assign":O="=";break}v=Math.max(N.line.indexOf(O,v),0)}else v=0;D(Pr("| ",6)),D(Pr("^^^",v+3)+ge,"font-weight:bold"),D(Pr("| ",6)),D(P+ge,"font-weight:bold")}),D(Pr("| ",6)+ge)}else D(Pr(N.number,4)+"|  "),D(N.line+ge,"color:red")}),typeof document!="undefined"&&!window.chrome?(j[0]=I.join("%c"),console.log.apply(console,j)):console.log(I.join(""))}),Se.raise("Error compiling "+S+" shader, "+G[0].name)}}function Ff(e,n,s,x,w){if(!e.getProgramParameter(n,e.LINK_STATUS)){var E=e.getProgramInfoLog(n),S=Kt(s,w),G=Kt(x,w),C='Error linking program with vertex shader, "'+G[0].name+'", and fragment shader "'+S[0].name+'"';typeof document!="undefined"?console.log("%c"+C+ge+"%c"+E,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(C+ge+E),Se.raise(C)}}function ta(e){e._commandRef=yr()}function Pf(e,n,s,x){ta(e);function w(C){return C?x.id(C):0}e._fragId=w(e.static.frag),e._vertId=w(e.static.vert);function E(C,B){Object.keys(B).forEach(function(M){C[x.id(M)]=!0})}var S=e._uniformSet={};E(S,n.static),E(S,n.dynamic);var G=e._attributeSet={};E(G,s.static),E(G,s.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function vt(e,n){var s=ra();Pe(e+" in command "+(n||yr())+(s==="unknown"?"":" called from "+s))}function Nf(e,n,s){e||vt(n,s||yr())}function Bf(e,n,s,x){e in n||vt("unknown parameter ("+e+")"+sr(s)+". possible values: "+Object.keys(n).join(),x||yr())}function na(e,n,s,x){Kn(e,n)||vt("invalid parameter type"+sr(s)+". expected "+n+", got "+typeof e,x||yr())}function If(e){e()}function kf(e,n,s){e.texture?qt(e.texture._texture.internalformat,n,"unsupported texture format for attachment"):qt(e.renderbuffer._renderbuffer.format,s,"unsupported renderbuffer format for attachment")}var pt=33071,aa=9728,Mf=9984,Uf=9985,Vf=9986,zf=9987,Hf=5120,jf=5121,Xf=5122,$f=5123,Wf=5124,Yf=5125,ia=5126,fa=32819,oa=32820,sa=33635,ua=34042,qf=36193,Qe={};Qe[Hf]=Qe[jf]=1,Qe[Xf]=Qe[$f]=Qe[qf]=Qe[sa]=Qe[fa]=Qe[oa]=2,Qe[Wf]=Qe[Yf]=Qe[ia]=Qe[ua]=4;function ca(e,n){return e===oa||e===fa||e===sa?2:e===ua?4:Qe[e]*n}function _t(e){return!(e&e-1)&&!!e}function Qf(e,n,s){var x,w=n.width,E=n.height,S=n.channels;Se(w>0&&w<=s.maxTextureSize&&E>0&&E<=s.maxTextureSize,"invalid texture shape"),(e.wrapS!==pt||e.wrapT!==pt)&&Se(_t(w)&&_t(E),"incompatible wrap mode for texture, both width and height must be power of 2"),n.mipmask===1?w!==1&&E!==1&&Se(e.minFilter!==Mf&&e.minFilter!==Vf&&e.minFilter!==Uf&&e.minFilter!==zf,"min filter requires mipmap"):(Se(_t(w)&&_t(E),"texture must be a square power of 2 to support mipmapping"),Se(n.mipmask===(w<<1)-1,"missing or incomplete mipmap data")),n.type===ia&&(s.extensions.indexOf("oes_texture_float_linear")<0&&Se(e.minFilter===aa&&e.magFilter===aa,"filter not supported, must enable oes_texture_float_linear"),Se(!e.genMipmaps,"mipmap generation not supported with float textures"));var G=n.images;for(x=0;x<16;++x)if(G[x]){var C=w>>x,B=E>>x;Se(n.mipmask&1<<x,"missing mipmap data");var M=G[x];if(Se(M.width===C&&M.height===B,"invalid shape for mip images"),Se(M.format===n.format&&M.internalformat===n.internalformat&&M.type===n.type,"incompatible type for mip image"),!M.compressed)if(M.data){var I=Math.ceil(ca(M.type,S)*C/M.unpackAlignment)*M.unpackAlignment;Se(M.data.byteLength===I*B,"invalid data for image, buffer size is inconsistent with image format")}else M.element||M.copy}else e.genMipmaps||Se((n.mipmask&1<<x)==0,"extra mipmap data");n.compressed&&Se(!e.genMipmaps,"mipmap generation for compressed images not supported")}function Kf(e,n,s,x){var w=e.width,E=e.height,S=e.channels;Se(w>0&&w<=x.maxTextureSize&&E>0&&E<=x.maxTextureSize,"invalid texture shape"),Se(w===E,"cube map must be square"),Se(n.wrapS===pt&&n.wrapT===pt,"wrap mode not supported by cube map");for(var G=0;G<s.length;++G){var C=s[G];Se(C.width===w&&C.height===E,"inconsistent cube map face shape"),n.genMipmaps&&(Se(!C.compressed,"can not generate mipmap for compressed textures"),Se(C.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var B=C.images,M=0;M<16;++M){var I=B[M];if(I){var j=w>>M,D=E>>M;Se(C.mipmask&1<<M,"missing mipmap data"),Se(I.width===j&&I.height===D,"invalid shape for mip images"),Se(I.format===e.format&&I.internalformat===e.internalformat&&I.type===e.type,"incompatible type for mip image"),I.compressed||(I.data?Se(I.data.byteLength===j*D*Math.max(ca(I.type,S),I.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):I.element||I.copy)}}}}var a=ce(Se,{optional:If,raise:Pe,commandRaise:vt,command:Nf,parameter:Fr,commandParameter:Bf,constructor:Rf,type:Lf,commandType:na,isTypedArray:wf,nni:Of,oneOf:qt,shaderError:Df,linkError:Ff,callSite:ra,saveCommandRef:ta,saveDrawInfo:Pf,framebufferFormat:kf,guessCommand:yr,texture2D:Qf,textureCube:Kf}),Zf=0,Jf=0,eo=5,ro=6;function Er(e,n){this.id=Zf++,this.type=e,this.data=n}function la(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Qr(e){if(e.length===0)return[];var n=e.charAt(0),s=e.charAt(e.length-1);if(e.length>1&&n===s&&(n==='"'||n==="'"))return['"'+la(e.substr(1,e.length-2))+'"'];var x=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(x)return Qr(e.substr(0,x.index)).concat(Qr(x[1])).concat(Qr(e.substr(x.index+x[0].length)));var w=e.split(".");if(w.length===1)return['"'+la(e)+'"'];for(var E=[],S=0;S<w.length;++S)E=E.concat(Qr(w[S]));return E}function da(e){return"["+Qr(e).join("][")+"]"}function to(e,n){return new Er(e,da(n+""))}function no(e){return typeof e=="function"&&!e._reglType||e instanceof Er}function ma(e,n){if(typeof e=="function")return new Er(Jf,e);if(typeof e=="number"||typeof e=="boolean")return new Er(eo,e);if(Array.isArray(e))return new Er(ro,e.map(function(s,x){return ma(s,n+"["+x+"]")}));if(e instanceof Er)return e;a(!1,"invalid option type in uniform "+n)}var Ke={DynamicVariable:Er,define:to,isDynamic:no,unbox:ma,accessor:da},Zt={next:typeof requestAnimationFrame=="function"?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:typeof cancelAnimationFrame=="function"?function(e){return cancelAnimationFrame(e)}:clearTimeout},ha=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ao(){var e={"":0},n=[""];return{id:function(s){var x=e[s];return x||(x=e[s]=n.length,n.push(s),x)},str:function(s){return n[s]}}}function io(e,n,s){var x=document.createElement("canvas");ce(x.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(x),e===document.body&&(x.style.position="absolute",ce(e.style,{margin:0,padding:0}));function w(){var G=window.innerWidth,C=window.innerHeight;if(e!==document.body){var B=e.getBoundingClientRect();G=B.right-B.left,C=B.bottom-B.top}x.width=s*G,x.height=s*C,ce(x.style,{width:G+"px",height:C+"px"})}var E;e!==document.body&&typeof ResizeObserver=="function"?(E=new ResizeObserver(function(){setTimeout(w)}),E.observe(e)):window.addEventListener("resize",w,!1);function S(){E?E.disconnect():window.removeEventListener("resize",w),e.removeChild(x)}return w(),{canvas:x,onDestroy:S}}function fo(e,n){function s(x){try{return e.getContext(x,n)}catch(w){return null}}return s("webgl")||s("experimental-webgl")||s("webgl-experimental")}function oo(e){return typeof e.nodeName=="string"&&typeof e.appendChild=="function"&&typeof e.getBoundingClientRect=="function"}function so(e){return typeof e.drawArrays=="function"||typeof e.drawElements=="function"}function va(e){return typeof e=="string"?e.split():(a(Array.isArray(e),"invalid extension array"),e)}function pa(e){return typeof e=="string"?(a(typeof document!="undefined","not supported outside of DOM"),document.querySelector(e)):e}function uo(e){var n=e||{},s,x,w,E,S={},G=[],C=[],B=typeof window=="undefined"?1:window.devicePixelRatio,M=!1,I=function(N){N&&a.raise(N)},j=function(){};if(typeof n=="string"?(a(typeof document!="undefined","selector queries only supported in DOM enviroments"),s=document.querySelector(n),a(s,"invalid query string for element")):typeof n=="object"?oo(n)?s=n:so(n)?(E=n,w=E.canvas):(a.constructor(n),"gl"in n?E=n.gl:"canvas"in n?w=pa(n.canvas):"container"in n&&(x=pa(n.container)),"attributes"in n&&(S=n.attributes,a.type(S,"object","invalid context attributes")),"extensions"in n&&(G=va(n.extensions)),"optionalExtensions"in n&&(C=va(n.optionalExtensions)),"onDone"in n&&(a.type(n.onDone,"function","invalid or missing onDone callback"),I=n.onDone),"profile"in n&&(M=!!n.profile),"pixelRatio"in n&&(B=+n.pixelRatio,a(B>0,"invalid pixel ratio"))):a.raise("invalid arguments to regl"),s&&(s.nodeName.toLowerCase()==="canvas"?w=s:x=s),!E){if(!w){a(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var D=io(x||document.body,I,B);if(!D)return null;w=D.canvas,j=D.onDestroy}S.premultipliedAlpha===void 0&&(S.premultipliedAlpha=!0),E=fo(w,S)}return E?{gl:E,canvas:w,container:x,extensions:G,optionalExtensions:C,pixelRatio:B,profile:M,onDone:I,onDestroy:j}:(j(),I("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function co(e,n){var s={};function x(S){a.type(S,"string","extension name must be string");var G=S.toLowerCase(),C;try{C=s[G]=e.getExtension(G)}catch(B){}return!!C}for(var w=0;w<n.extensions.length;++w){var E=n.extensions[w];if(!x(E))return n.onDestroy(),n.onDone('"'+E+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return n.optionalExtensions.forEach(x),{extensions:s,restore:function(){Object.keys(s).forEach(function(S){if(s[S]&&!x(S))throw new Error("(regl): error restoring extension "+S)})}}}function Ze(e,n){for(var s=Array(e),x=0;x<e;++x)s[x]=n(x);return s}var lo=5120,mo=5121,ho=5122,vo=5123,po=5124,_o=5125,bo=5126;function yo(e){for(var n=16;n<=1<<28;n*=16)if(e<=n)return n;return 0}function _a(e){var n,s;return n=(e>65535)<<4,e>>>=n,s=(e>255)<<3,e>>>=s,n|=s,s=(e>15)<<2,e>>>=s,n|=s,s=(e>3)<<1,e>>>=s,n|=s,n|e>>1}function ba(){var e=Ze(8,function(){return[]});function n(E){var S=yo(E),G=e[_a(S)>>2];return G.length>0?G.pop():new ArrayBuffer(S)}function s(E){e[_a(E.byteLength)>>2].push(E)}function x(E,S){var G=null;switch(E){case lo:G=new Int8Array(n(S),0,S);break;case mo:G=new Uint8Array(n(S),0,S);break;case ho:G=new Int16Array(n(2*S),0,S);break;case vo:G=new Uint16Array(n(2*S),0,S);break;case po:G=new Int32Array(n(4*S),0,S);break;case _o:G=new Uint32Array(n(4*S),0,S);break;case bo:G=new Float32Array(n(4*S),0,S);break;default:return null}return G.length!==S?G.subarray(0,S):G}function w(E){s(E.buffer)}return{alloc:n,free:s,allocType:x,freeType:w}}var Ne=ba();Ne.zero=ba();var Eo=3408,xo=3410,Ao=3411,To=3412,So=3413,go=3414,wo=3415,Lo=33901,Oo=33902,Ro=3379,Co=3386,Go=34921,Do=36347,Fo=36348,Po=35661,No=35660,Bo=34930,Io=36349,ko=34076,Mo=34024,Uo=7936,Vo=7937,zo=7938,Ho=35724,jo=34047,Xo=36063,$o=34852,bt=3553,ya=34067,Wo=34069,Yo=33984,Kr=6408,Jt=5126,Ea=5121,en=36160,qo=36053,Qo=36064,Ko=16384,Zo=function(e,n){var s=1;n.ext_texture_filter_anisotropic&&(s=e.getParameter(jo));var x=1,w=1;n.webgl_draw_buffers&&(x=e.getParameter($o),w=e.getParameter(Xo));var E=!!n.oes_texture_float;if(E){var S=e.createTexture();e.bindTexture(bt,S),e.texImage2D(bt,0,Kr,1,1,0,Kr,Jt,null);var G=e.createFramebuffer();if(e.bindFramebuffer(en,G),e.framebufferTexture2D(en,Qo,bt,S,0),e.bindTexture(bt,null),e.checkFramebufferStatus(en)!==qo)E=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(Ko);var C=Ne.allocType(Jt,4);e.readPixels(0,0,1,1,Kr,Jt,C),e.getError()?E=!1:(e.deleteFramebuffer(G),e.deleteTexture(S),E=C[0]===1),Ne.freeType(C)}}var B=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),M=!0;if(!B){var I=e.createTexture(),j=Ne.allocType(Ea,36);e.activeTexture(Yo),e.bindTexture(ya,I),e.texImage2D(Wo,0,Kr,3,3,0,Kr,Ea,j),Ne.freeType(j),e.bindTexture(ya,null),e.deleteTexture(I),M=!e.getError()}return{colorBits:[e.getParameter(xo),e.getParameter(Ao),e.getParameter(To),e.getParameter(So)],depthBits:e.getParameter(go),stencilBits:e.getParameter(wo),subpixelBits:e.getParameter(Eo),extensions:Object.keys(n).filter(function(D){return!!n[D]}),maxAnisotropic:s,maxDrawbuffers:x,maxColorAttachments:w,pointSizeDims:e.getParameter(Lo),lineWidthDims:e.getParameter(Oo),maxViewportDims:e.getParameter(Co),maxCombinedTextureUnits:e.getParameter(Po),maxCubeMapSize:e.getParameter(ko),maxRenderbufferSize:e.getParameter(Mo),maxTextureUnits:e.getParameter(Bo),maxTextureSize:e.getParameter(Ro),maxAttributes:e.getParameter(Go),maxVertexUniforms:e.getParameter(Do),maxVertexTextureUnits:e.getParameter(No),maxVaryingVectors:e.getParameter(Fo),maxFragmentUniforms:e.getParameter(Io),glsl:e.getParameter(Ho),renderer:e.getParameter(Vo),vendor:e.getParameter(Uo),version:e.getParameter(zo),readFloat:E,npotTextureCube:M}};function rr(e){return!!e&&typeof e=="object"&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&typeof e.offset=="number"&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||K(e.data))}var Je=function(e){return Object.keys(e).map(function(n){return e[n]})},yt={shape:ts,flatten:rs};function Jo(e,n,s){for(var x=0;x<n;++x)s[x]=e[x]}function es(e,n,s,x){for(var w=0,E=0;E<n;++E)for(var S=e[E],G=0;G<s;++G)x[w++]=S[G]}function xa(e,n,s,x,w,E){for(var S=E,G=0;G<n;++G)for(var C=e[G],B=0;B<s;++B)for(var M=C[B],I=0;I<x;++I)w[S++]=M[I]}function Aa(e,n,s,x,w){for(var E=1,S=s+1;S<n.length;++S)E*=n[S];var G=n[s];if(n.length-s==4){var C=n[s+1],B=n[s+2],M=n[s+3];for(S=0;S<G;++S)xa(e[S],C,B,M,x,w),w+=E}else for(S=0;S<G;++S)Aa(e[S],n,s+1,x,w),w+=E}function rs(e,n,s,x){var w=1;if(n.length)for(var E=0;E<n.length;++E)w*=n[E];else w=0;var S=x||Ne.allocType(s,w);switch(n.length){case 0:break;case 1:Jo(e,n[0],S);break;case 2:es(e,n[0],n[1],S);break;case 3:xa(e,n[0],n[1],n[2],S,0);break;default:Aa(e,n,0,S,0)}return S}function ts(e){for(var n=[],s=e;s.length;s=s[0])n.push(s.length);return n}var rn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ns=5120,as=5122,is=5124,fs=5121,os=5123,ss=5125,us=5126,cs=5126,xr={int8:ns,int16:as,int32:is,uint8:fs,uint16:os,uint32:ss,float:us,float32:cs},ls=35048,ds=35040,Et={dynamic:ls,stream:ds,static:35044},tn=yt.flatten,Ta=yt.shape,Sa=35044,ms=35040,nn=5121,an=5126,lr=[];lr[5120]=1,lr[5122]=2,lr[5124]=4,lr[5121]=1,lr[5123]=2,lr[5125]=4,lr[5126]=4;function xt(e){return rn[Object.prototype.toString.call(e)]|0}function ga(e,n){for(var s=0;s<n.length;++s)e[s]=n[s]}function wa(e,n,s,x,w,E,S){for(var G=0,C=0;C<s;++C)for(var B=0;B<x;++B)e[G++]=n[w*C+E*B+S]}function hs(e,n,s,x){var w=0,E={};function S(v){this.id=w++,this.buffer=e.createBuffer(),this.type=v,this.usage=Sa,this.byteLength=0,this.dimension=1,this.dtype=nn,this.persistentData=null,s.profile&&(this.stats={size:0})}S.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},S.prototype.destroy=function(){j(this)};var G=[];function C(v,T){var P=G.pop();return P||(P=new S(v)),P.bind(),I(P,T,ms,0,1,!1),P}function B(v){G.push(v)}function M(v,T,P){v.byteLength=T.byteLength,e.bufferData(v.type,T,P)}function I(v,T,P,ee,O,Z){var Y;if(v.usage=P,Array.isArray(T)){if(v.dtype=ee||an,T.length>0){var fe;if(Array.isArray(T[0])){Y=Ta(T);for(var L=1,g=1;g<Y.length;++g)L*=Y[g];v.dimension=L,fe=tn(T,Y,v.dtype),M(v,fe,P),Z?v.persistentData=fe:Ne.freeType(fe)}else if(typeof T[0]=="number"){v.dimension=O;var ne=Ne.allocType(v.dtype,T.length);ga(ne,T),M(v,ne,P),Z?v.persistentData=ne:Ne.freeType(ne)}else K(T[0])?(v.dimension=T[0].length,v.dtype=ee||xt(T[0])||an,fe=tn(T,[T.length,T[0].length],v.dtype),M(v,fe,P),Z?v.persistentData=fe:Ne.freeType(fe)):a.raise("invalid buffer data")}}else if(K(T))v.dtype=ee||xt(T),v.dimension=O,M(v,T,P),Z&&(v.persistentData=new Uint8Array(new Uint8Array(T.buffer)));else if(rr(T)){Y=T.shape;var X=T.stride,F=T.offset,$=0,W=0,me=0,le=0;Y.length===1?($=Y[0],W=1,me=X[0],le=0):Y.length===2?($=Y[0],W=Y[1],me=X[0],le=X[1]):a.raise("invalid shape"),v.dtype=ee||xt(T.data)||an,v.dimension=W;var q=Ne.allocType(v.dtype,$*W);wa(q,T.data,$,W,me,le,F),M(v,q,P),Z?v.persistentData=q:Ne.freeType(q)}else T instanceof ArrayBuffer?(v.dtype=nn,v.dimension=O,M(v,T,P),Z&&(v.persistentData=new Uint8Array(new Uint8Array(T)))):a.raise("invalid buffer data")}function j(v){n.bufferCount--,x(v);var T=v.buffer;a(T,"buffer must not be deleted already"),e.deleteBuffer(T),v.buffer=null,delete E[v.id]}function D(v,T,P,ee){n.bufferCount++;var O=new S(T);E[O.id]=O;function Z(L){var g=Sa,ne=null,X=0,F=0,$=1;return Array.isArray(L)||K(L)||rr(L)||L instanceof ArrayBuffer?ne=L:typeof L=="number"?X=L|0:L&&(a.type(L,"object","buffer arguments must be an object, a number or an array"),"data"in L&&(a(ne===null||Array.isArray(ne)||K(ne)||rr(ne),"invalid data for buffer"),ne=L.data),"usage"in L&&(a.parameter(L.usage,Et,"invalid buffer usage"),g=Et[L.usage]),"type"in L&&(a.parameter(L.type,xr,"invalid buffer type"),F=xr[L.type]),"dimension"in L&&(a.type(L.dimension,"number","invalid dimension"),$=L.dimension|0),"length"in L&&(a.nni(X,"buffer length must be a nonnegative integer"),X=L.length|0)),O.bind(),ne?I(O,ne,g,F,$,ee):(X&&e.bufferData(O.type,X,g),O.dtype=F||nn,O.usage=g,O.dimension=$,O.byteLength=X),s.profile&&(O.stats.size=O.byteLength*lr[O.dtype]),Z}function Y(L,g){a(g+L.byteLength<=O.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+L.byteLength+" starting from offset "+g+" to a buffer of size "+O.byteLength),e.bufferSubData(O.type,g,L)}function fe(L,g){var ne=(g||0)|0,X;if(O.bind(),K(L)||L instanceof ArrayBuffer)Y(L,ne);else if(Array.isArray(L)){if(L.length>0)if(typeof L[0]=="number"){var F=Ne.allocType(O.dtype,L.length);ga(F,L),Y(F,ne),Ne.freeType(F)}else if(Array.isArray(L[0])||K(L[0])){X=Ta(L);var $=tn(L,X,O.dtype);Y($,ne),Ne.freeType($)}else a.raise("invalid buffer data")}else if(rr(L)){X=L.shape;var W=L.stride,me=0,le=0,q=0,J=0;X.length===1?(me=X[0],le=1,q=W[0],J=0):X.length===2?(me=X[0],le=X[1],q=W[0],J=W[1]):a.raise("invalid shape");var ue=Array.isArray(L.data)?O.dtype:xt(L.data),de=Ne.allocType(ue,me*le);wa(de,L.data,me,le,q,J,L.offset),Y(de,ne),Ne.freeType(de)}else a.raise("invalid data for buffer subdata");return Z}return P||Z(v),Z._reglType="buffer",Z._buffer=O,Z.subdata=fe,s.profile&&(Z.stats=O.stats),Z.destroy=function(){j(O)},Z}function N(){Je(E).forEach(function(v){v.buffer=e.createBuffer(),e.bindBuffer(v.type,v.buffer),e.bufferData(v.type,v.persistentData||v.byteLength,v.usage)})}return s.profile&&(n.getTotalBufferSize=function(){var v=0;return Object.keys(E).forEach(function(T){v+=E[T].stats.size}),v}),{create:D,createStream:C,destroyStream:B,clear:function(){Je(E).forEach(j),G.forEach(j)},getBuffer:function(v){return v&&v._buffer instanceof S?v._buffer:null},restore:N,_initBuffer:I}}var vs=0,ps=0,_s=1,bs=1,ys=4,Es=4,dr={points:vs,point:ps,lines:_s,line:bs,triangles:ys,triangle:Es,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},xs=0,As=1,Zr=4,Ts=5120,Nr=5121,La=5122,Br=5123,Oa=5124,Ar=5125,fn=34963,Ss=35040,gs=35044;function ws(e,n,s,x){var w={},E=0,S={uint8:Nr,uint16:Br};n.oes_element_index_uint&&(S.uint32=Ar);function G(N){this.id=E++,w[this.id]=this,this.buffer=N,this.primType=Zr,this.vertCount=0,this.type=0}G.prototype.bind=function(){this.buffer.bind()};var C=[];function B(N){var v=C.pop();return v||(v=new G(s.create(null,fn,!0,!1)._buffer)),I(v,N,Ss,-1,-1,0,0),v}function M(N){C.push(N)}function I(N,v,T,P,ee,O,Z){N.buffer.bind();var Y;if(v){var fe=Z;!Z&&(!K(v)||rr(v)&&!K(v.data))&&(fe=n.oes_element_index_uint?Ar:Br),s._initBuffer(N.buffer,v,T,fe,3)}else e.bufferData(fn,O,T),N.buffer.dtype=Y||Nr,N.buffer.usage=T,N.buffer.dimension=3,N.buffer.byteLength=O;if(Y=Z,!Z){switch(N.buffer.dtype){case Nr:case Ts:Y=Nr;break;case Br:case La:Y=Br;break;case Ar:case Oa:Y=Ar;break;default:a.raise("unsupported type for element array")}N.buffer.dtype=Y}N.type=Y,a(Y!==Ar||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var L=ee;L<0&&(L=N.buffer.byteLength,Y===Br?L>>=1:Y===Ar&&(L>>=2)),N.vertCount=L;var g=P;if(P<0){g=Zr;var ne=N.buffer.dimension;ne===1&&(g=xs),ne===2&&(g=As),ne===3&&(g=Zr)}N.primType=g}function j(N){x.elementsCount--,a(N.buffer!==null,"must not double destroy elements"),delete w[N.id],N.buffer.destroy(),N.buffer=null}function D(N,v){var T=s.create(null,fn,!0),P=new G(T._buffer);x.elementsCount++;function ee(O){if(!O)T(),P.primType=Zr,P.vertCount=0,P.type=Nr;else if(typeof O=="number")T(O),P.primType=Zr,P.vertCount=O|0,P.type=Nr;else{var Z=null,Y=gs,fe=-1,L=-1,g=0,ne=0;Array.isArray(O)||K(O)||rr(O)?Z=O:(a.type(O,"object","invalid arguments for elements"),"data"in O&&(Z=O.data,a(Array.isArray(Z)||K(Z)||rr(Z),"invalid data for element buffer")),"usage"in O&&(a.parameter(O.usage,Et,"invalid element buffer usage"),Y=Et[O.usage]),"primitive"in O&&(a.parameter(O.primitive,dr,"invalid element buffer primitive"),fe=dr[O.primitive]),"count"in O&&(a(typeof O.count=="number"&&O.count>=0,"invalid vertex count for elements"),L=O.count|0),"type"in O&&(a.parameter(O.type,S,"invalid buffer type"),ne=S[O.type]),"length"in O?g=O.length|0:(g=L,ne===Br||ne===La?g*=2:(ne===Ar||ne===Oa)&&(g*=4))),I(P,Z,Y,fe,L,g,ne)}return ee}return ee(N),ee._reglType="elements",ee._elements=P,ee.subdata=function(O,Z){return T.subdata(O,Z),ee},ee.destroy=function(){j(P)},ee}return{create:D,createStream:B,destroyStream:M,getElements:function(N){return typeof N=="function"&&N._elements instanceof G?N._elements:null},clear:function(){Je(w).forEach(j)}}}var Ra=new Float32Array(1),Ls=new Uint32Array(Ra.buffer),Os=5123;function Ca(e){for(var n=Ne.allocType(Os,e.length),s=0;s<e.length;++s)if(isNaN(e[s]))n[s]=65535;else if(e[s]===Infinity)n[s]=31744;else if(e[s]===-Infinity)n[s]=64512;else{Ra[0]=e[s];var x=Ls[0],w=x>>>31<<15,E=(x<<1>>>24)-127,S=x>>13&(1<<10)-1;if(E<-24)n[s]=w;else if(E<-14){var G=-14-E;n[s]=w+(S+(1<<10)>>G)}else E>15?n[s]=w+31744:n[s]=w+(E+15<<10)+S}return n}function Ce(e){return Array.isArray(e)||K(e)}var Ga=function(e){return!(e&e-1)&&!!e},Rs=34467,ar=3553,on=34067,At=34069,Tr=6408,sn=6406,Tt=6407,Jr=6409,St=6410,Da=32854,un=32855,Fa=36194,Cs=32819,Gs=32820,Ds=33635,Fs=34042,cn=6402,gt=34041,ln=35904,dn=35906,Ir=36193,mn=33776,hn=33777,vn=33778,pn=33779,Pa=35986,Na=35987,Ba=34798,Ia=35840,ka=35841,Ma=35842,Ua=35843,Va=36196,kr=5121,_n=5123,bn=5125,et=5126,Ps=10242,Ns=10243,Bs=10497,yn=33071,Is=33648,ks=10240,Ms=10241,En=9728,Us=9729,xn=9984,za=9985,Ha=9986,An=9987,Vs=33170,wt=4352,zs=4353,Hs=4354,js=34046,Xs=3317,$s=37440,Ws=37441,Ys=37443,ja=37444,rt=33984,qs=[xn,Ha,za,An],Lt=[0,Jr,St,Tt,Tr],er={};er[Jr]=er[sn]=er[cn]=1,er[gt]=er[St]=2,er[Tt]=er[ln]=3,er[Tr]=er[dn]=4;function Mr(e){return"[object "+e+"]"}var Xa=Mr("HTMLCanvasElement"),$a=Mr("OffscreenCanvas"),Wa=Mr("CanvasRenderingContext2D"),Ya=Mr("ImageBitmap"),qa=Mr("HTMLImageElement"),Qa=Mr("HTMLVideoElement"),Qs=Object.keys(rn).concat([Xa,$a,Wa,Ya,qa,Qa]),Ur=[];Ur[kr]=1,Ur[et]=4,Ur[Ir]=2,Ur[_n]=2,Ur[bn]=4;var Xe=[];Xe[Da]=2,Xe[un]=2,Xe[Fa]=2,Xe[gt]=4,Xe[mn]=.5,Xe[hn]=.5,Xe[vn]=1,Xe[pn]=1,Xe[Pa]=.5,Xe[Na]=1,Xe[Ba]=1,Xe[Ia]=.5,Xe[ka]=.25,Xe[Ma]=.5,Xe[Ua]=.25,Xe[Va]=.5;function Ka(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")}function Za(e){if(!Array.isArray(e))return!1;var n=e.length;return!(n===0||!Ce(e[0]))}function Sr(e){return Object.prototype.toString.call(e)}function Ja(e){return Sr(e)===Xa}function ei(e){return Sr(e)===$a}function Ks(e){return Sr(e)===Wa}function Zs(e){return Sr(e)===Ya}function Js(e){return Sr(e)===qa}function eu(e){return Sr(e)===Qa}function Tn(e){if(!e)return!1;var n=Sr(e);return Qs.indexOf(n)>=0?!0:Ka(e)||Za(e)||rr(e)}function ri(e){return rn[Object.prototype.toString.call(e)]|0}function ru(e,n){var s=n.length;switch(e.type){case kr:case _n:case bn:case et:var x=Ne.allocType(e.type,s);x.set(n),e.data=x;break;case Ir:e.data=Ca(n);break;default:a.raise("unsupported texture type, must specify a typed array")}}function ti(e,n){return Ne.allocType(e.type===Ir?et:e.type,n)}function ni(e,n){e.type===Ir?(e.data=Ca(n),Ne.freeType(n)):e.data=n}function tu(e,n,s,x,w,E){for(var S=e.width,G=e.height,C=e.channels,B=S*G*C,M=ti(e,B),I=0,j=0;j<G;++j)for(var D=0;D<S;++D)for(var N=0;N<C;++N)M[I++]=n[s*D+x*j+w*N+E];ni(e,M)}function Ot(e,n,s,x,w,E){var S;if(typeof Xe[e]!="undefined"?S=Xe[e]:S=er[e]*Ur[n],E&&(S*=6),w){for(var G=0,C=s;C>=1;)G+=S*C*C,C/=2;return G}else return S*s*x}function nu(e,n,s,x,w,E,S){var G={"don't care":wt,"dont care":wt,nice:Hs,fast:zs},C={repeat:Bs,clamp:yn,mirror:Is},B={nearest:En,linear:Us},M=ce({mipmap:An,"nearest mipmap nearest":xn,"linear mipmap nearest":za,"nearest mipmap linear":Ha,"linear mipmap linear":An},B),I={none:0,browser:ja},j={uint8:kr,rgba4:Cs,rgb565:Ds,"rgb5 a1":Gs},D={alpha:sn,luminance:Jr,"luminance alpha":St,rgb:Tt,rgba:Tr,rgba4:Da,"rgb5 a1":un,rgb565:Fa},N={};n.ext_srgb&&(D.srgb=ln,D.srgba=dn),n.oes_texture_float&&(j.float32=j.float=et),n.oes_texture_half_float&&(j.float16=j["half float"]=Ir),n.webgl_depth_texture&&(ce(D,{depth:cn,"depth stencil":gt}),ce(j,{uint16:_n,uint32:bn,"depth stencil":Fs})),n.webgl_compressed_texture_s3tc&&ce(N,{"rgb s3tc dxt1":mn,"rgba s3tc dxt1":hn,"rgba s3tc dxt3":vn,"rgba s3tc dxt5":pn}),n.webgl_compressed_texture_atc&&ce(N,{"rgb atc":Pa,"rgba atc explicit alpha":Na,"rgba atc interpolated alpha":Ba}),n.webgl_compressed_texture_pvrtc&&ce(N,{"rgb pvrtc 4bppv1":Ia,"rgb pvrtc 2bppv1":ka,"rgba pvrtc 4bppv1":Ma,"rgba pvrtc 2bppv1":Ua}),n.webgl_compressed_texture_etc1&&(N["rgb etc1"]=Va);var v=Array.prototype.slice.call(e.getParameter(Rs));Object.keys(N).forEach(function(f){var A=N[f];v.indexOf(A)>=0&&(D[f]=A)});var T=Object.keys(D);s.textureFormats=T;var P=[];Object.keys(D).forEach(function(f){var A=D[f];P[A]=f});var ee=[];Object.keys(j).forEach(function(f){var A=j[f];ee[A]=f});var O=[];Object.keys(B).forEach(function(f){var A=B[f];O[A]=f});var Z=[];Object.keys(M).forEach(function(f){var A=M[f];Z[A]=f});var Y=[];Object.keys(C).forEach(function(f){var A=C[f];Y[A]=f});var fe=T.reduce(function(f,A){var y=D[A];return y===Jr||y===sn||y===Jr||y===St||y===cn||y===gt||n.ext_srgb&&(y===ln||y===dn)?f[y]=y:y===un||A.indexOf("rgba")>=0?f[y]=Tr:f[y]=Tt,f},{});function L(){this.internalformat=Tr,this.format=Tr,this.type=kr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=ja,this.width=0,this.height=0,this.channels=0}function g(f,A){f.internalformat=A.internalformat,f.format=A.format,f.type=A.type,f.compressed=A.compressed,f.premultiplyAlpha=A.premultiplyAlpha,f.flipY=A.flipY,f.unpackAlignment=A.unpackAlignment,f.colorSpace=A.colorSpace,f.width=A.width,f.height=A.height,f.channels=A.channels}function ne(f,A){if(!(typeof A!="object"||!A)){if("premultiplyAlpha"in A&&(a.type(A.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),f.premultiplyAlpha=A.premultiplyAlpha),"flipY"in A&&(a.type(A.flipY,"boolean","invalid texture flip"),f.flipY=A.flipY),"alignment"in A&&(a.oneOf(A.alignment,[1,2,4,8],"invalid texture unpack alignment"),f.unpackAlignment=A.alignment),"colorSpace"in A&&(a.parameter(A.colorSpace,I,"invalid colorSpace"),f.colorSpace=I[A.colorSpace]),"type"in A){var y=A.type;a(n.oes_texture_float||!(y==="float"||y==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),a(n.oes_texture_half_float||!(y==="half float"||y==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),a(n.webgl_depth_texture||!(y==="uint16"||y==="uint32"||y==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),a.parameter(y,j,"invalid texture type"),f.type=j[y]}var te=f.width,_e=f.height,i=f.channels,r=!1;"shape"in A?(a(Array.isArray(A.shape)&&A.shape.length>=2,"shape must be an array"),te=A.shape[0],_e=A.shape[1],A.shape.length===3&&(i=A.shape[2],a(i>0&&i<=4,"invalid number of channels"),r=!0),a(te>=0&&te<=s.maxTextureSize,"invalid width"),a(_e>=0&&_e<=s.maxTextureSize,"invalid height")):("radius"in A&&(te=_e=A.radius,a(te>=0&&te<=s.maxTextureSize,"invalid radius")),"width"in A&&(te=A.width,a(te>=0&&te<=s.maxTextureSize,"invalid width")),"height"in A&&(_e=A.height,a(_e>=0&&_e<=s.maxTextureSize,"invalid height")),"channels"in A&&(i=A.channels,a(i>0&&i<=4,"invalid number of channels"),r=!0)),f.width=te|0,f.height=_e|0,f.channels=i|0;var c=!1;if("format"in A){var h=A.format;a(n.webgl_depth_texture||!(h==="depth"||h==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),a.parameter(h,D,"invalid texture format");var p=f.internalformat=D[h];f.format=fe[p],h in j&&("type"in A||(f.type=j[h])),h in N&&(f.compressed=!0),c=!0}!r&&c?f.channels=er[f.format]:r&&!c?f.channels!==Lt[f.format]&&(f.format=f.internalformat=Lt[f.channels]):c&&r&&a(f.channels===er[f.format],"number of channels inconsistent with specified format")}}function X(f){e.pixelStorei($s,f.flipY),e.pixelStorei(Ws,f.premultiplyAlpha),e.pixelStorei(Ys,f.colorSpace),e.pixelStorei(Xs,f.unpackAlignment)}function F(){L.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function $(f,A){var y=null;if(Tn(A)?y=A:A&&(a.type(A,"object","invalid pixel data type"),ne(f,A),"x"in A&&(f.xOffset=A.x|0),"y"in A&&(f.yOffset=A.y|0),Tn(A.data)&&(y=A.data)),a(!f.compressed||y instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),A.copy){a(!y,"can not specify copy and data field for the same texture");var te=w.viewportWidth,_e=w.viewportHeight;f.width=f.width||te-f.xOffset,f.height=f.height||_e-f.yOffset,f.needsCopy=!0,a(f.xOffset>=0&&f.xOffset<te&&f.yOffset>=0&&f.yOffset<_e&&f.width>0&&f.width<=te&&f.height>0&&f.height<=_e,"copy texture read out of bounds")}else if(!y)f.width=f.width||1,f.height=f.height||1,f.channels=f.channels||4;else if(K(y))f.channels=f.channels||4,f.data=y,!("type"in A)&&f.type===kr&&(f.type=ri(y));else if(Ka(y))f.channels=f.channels||4,ru(f,y),f.alignment=1,f.needsFree=!0;else if(rr(y)){var i=y.data;!Array.isArray(i)&&f.type===kr&&(f.type=ri(i));var r=y.shape,c=y.stride,h,p,d,l,_,t;r.length===3?(d=r[2],t=c[2]):(a(r.length===2,"invalid ndarray pixel data, must be 2 or 3D"),d=1,t=1),h=r[0],p=r[1],l=c[0],_=c[1],f.alignment=1,f.width=h,f.height=p,f.channels=d,f.format=f.internalformat=Lt[d],f.needsFree=!0,tu(f,i,l,_,t,y.offset)}else if(Ja(y)||ei(y)||Ks(y))Ja(y)||ei(y)?f.element=y:f.element=y.canvas,f.width=f.element.width,f.height=f.element.height,f.channels=4;else if(Zs(y))f.element=y,f.width=y.width,f.height=y.height,f.channels=4;else if(Js(y))f.element=y,f.width=y.naturalWidth,f.height=y.naturalHeight,f.channels=4;else if(eu(y))f.element=y,f.width=y.videoWidth,f.height=y.videoHeight,f.channels=4;else if(Za(y)){var u=f.width||y[0].length,o=f.height||y.length,m=f.channels;Ce(y[0][0])?m=m||y[0][0].length:m=m||1;for(var b=yt.shape(y),R=1,U=0;U<b.length;++U)R*=b[U];var H=ti(f,R);yt.flatten(y,b,"",H),ni(f,H),f.alignment=1,f.width=u,f.height=o,f.channels=m,f.format=f.internalformat=Lt[m],f.needsFree=!0}f.type===et?a(s.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):f.type===Ir&&a(s.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function W(f,A,y){var te=f.element,_e=f.data,i=f.internalformat,r=f.format,c=f.type,h=f.width,p=f.height;X(f),te?e.texImage2D(A,y,r,r,c,te):f.compressed?e.compressedTexImage2D(A,y,i,h,p,0,_e):f.needsCopy?(x(),e.copyTexImage2D(A,y,r,f.xOffset,f.yOffset,h,p,0)):e.texImage2D(A,y,r,h,p,0,r,c,_e||null)}function me(f,A,y,te,_e){var i=f.element,r=f.data,c=f.internalformat,h=f.format,p=f.type,d=f.width,l=f.height;X(f),i?e.texSubImage2D(A,_e,y,te,h,p,i):f.compressed?e.compressedTexSubImage2D(A,_e,y,te,c,d,l,r):f.needsCopy?(x(),e.copyTexSubImage2D(A,_e,y,te,f.xOffset,f.yOffset,d,l)):e.texSubImage2D(A,_e,y,te,d,l,h,p,r)}var le=[];function q(){return le.pop()||new F}function J(f){f.needsFree&&Ne.freeType(f.data),F.call(f),le.push(f)}function ue(){L.call(this),this.genMipmaps=!1,this.mipmapHint=wt,this.mipmask=0,this.images=Array(16)}function de(f,A,y){var te=f.images[0]=q();f.mipmask=1,te.width=f.width=A,te.height=f.height=y,te.channels=f.channels=4}function be(f,A){var y=null;if(Tn(A))y=f.images[0]=q(),g(y,f),$(y,A),f.mipmask=1;else if(ne(f,A),Array.isArray(A.mipmap))for(var te=A.mipmap,_e=0;_e<te.length;++_e)y=f.images[_e]=q(),g(y,f),y.width>>=_e,y.height>>=_e,$(y,te[_e]),f.mipmask|=1<<_e;else y=f.images[0]=q(),g(y,f),$(y,A),f.mipmask=1;g(f,f.images[0]),f.compressed&&(f.internalformat===mn||f.internalformat===hn||f.internalformat===vn||f.internalformat===pn)&&a(f.width%4==0&&f.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Le(f,A){for(var y=f.images,te=0;te<y.length;++te){if(!y[te])return;W(y[te],A,te)}}var Re=[];function Ee(){var f=Re.pop()||new ue;L.call(f),f.mipmask=0;for(var A=0;A<16;++A)f.images[A]=null;return f}function Ie(f){for(var A=f.images,y=0;y<A.length;++y)A[y]&&J(A[y]),A[y]=null;Re.push(f)}function we(){this.minFilter=En,this.magFilter=En,this.wrapS=yn,this.wrapT=yn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=wt}function Be(f,A){if("min"in A){var y=A.min;a.parameter(y,M),f.minFilter=M[y],qs.indexOf(f.minFilter)>=0&&!("faces"in A)&&(f.genMipmaps=!0)}if("mag"in A){var te=A.mag;a.parameter(te,B),f.magFilter=B[te]}var _e=f.wrapS,i=f.wrapT;if("wrap"in A){var r=A.wrap;typeof r=="string"?(a.parameter(r,C),_e=i=C[r]):Array.isArray(r)&&(a.parameter(r[0],C),a.parameter(r[1],C),_e=C[r[0]],i=C[r[1]])}else{if("wrapS"in A){var c=A.wrapS;a.parameter(c,C),_e=C[c]}if("wrapT"in A){var h=A.wrapT;a.parameter(h,C),i=C[h]}}if(f.wrapS=_e,f.wrapT=i,"anisotropic"in A){var p=A.anisotropic;a(typeof p=="number"&&p>=1&&p<=s.maxAnisotropic,"aniso samples must be between 1 and "),f.anisotropic=A.anisotropic}if("mipmap"in A){var d=!1;switch(typeof A.mipmap){case"string":a.parameter(A.mipmap,G,"invalid mipmap hint"),f.mipmapHint=G[A.mipmap],f.genMipmaps=!0,d=!0;break;case"boolean":d=f.genMipmaps=A.mipmap;break;case"object":a(Array.isArray(A.mipmap),"invalid mipmap type"),f.genMipmaps=!1,d=!0;break;default:a.raise("invalid mipmap type")}d&&!("min"in A)&&(f.minFilter=xn)}}function ke(f,A){e.texParameteri(A,Ms,f.minFilter),e.texParameteri(A,ks,f.magFilter),e.texParameteri(A,Ps,f.wrapS),e.texParameteri(A,Ns,f.wrapT),n.ext_texture_filter_anisotropic&&e.texParameteri(A,js,f.anisotropic),f.genMipmaps&&(e.hint(Vs,f.mipmapHint),e.generateMipmap(A))}var Me=0,je={},$e=s.maxTextureUnits,De=Array($e).map(function(){return null});function ve(f){L.call(this),this.mipmask=0,this.internalformat=Tr,this.id=Me++,this.refCount=1,this.target=f,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new we,S.profile&&(this.stats={size:0})}function We(f){e.activeTexture(rt),e.bindTexture(f.target,f.texture)}function Te(){var f=De[0];f?e.bindTexture(f.target,f.texture):e.bindTexture(ar,null)}function se(f){var A=f.texture;a(A,"must not double destroy texture");var y=f.unit,te=f.target;y>=0&&(e.activeTexture(rt+y),e.bindTexture(te,null),De[y]=null),e.deleteTexture(A),f.texture=null,f.params=null,f.pixels=null,f.refCount=0,delete je[f.id],E.textureCount--}ce(ve.prototype,{bind:function(){var f=this;f.bindCount+=1;var A=f.unit;if(A<0){for(var y=0;y<$e;++y){var te=De[y];if(te){if(te.bindCount>0)continue;te.unit=-1}De[y]=f,A=y;break}A>=$e&&a.raise("insufficient number of texture units"),S.profile&&E.maxTextureUnits<A+1&&(E.maxTextureUnits=A+1),f.unit=A,e.activeTexture(rt+A),e.bindTexture(f.target,f.texture)}return A},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&se(this)}});function ye(f,A){var y=new ve(ar);je[y.id]=y,E.textureCount++;function te(r,c){var h=y.texInfo;we.call(h);var p=Ee();return typeof r=="number"?typeof c=="number"?de(p,r|0,c|0):de(p,r|0,r|0):r?(a.type(r,"object","invalid arguments to regl.texture"),Be(h,r),be(p,r)):de(p,1,1),h.genMipmaps&&(p.mipmask=(p.width<<1)-1),y.mipmask=p.mipmask,g(y,p),a.texture2D(h,p,s),y.internalformat=p.internalformat,te.width=p.width,te.height=p.height,We(y),Le(p,ar),ke(h,ar),Te(),Ie(p),S.profile&&(y.stats.size=Ot(y.internalformat,y.type,p.width,p.height,h.genMipmaps,!1)),te.format=P[y.internalformat],te.type=ee[y.type],te.mag=O[h.magFilter],te.min=Z[h.minFilter],te.wrapS=Y[h.wrapS],te.wrapT=Y[h.wrapT],te}function _e(r,c,h,p){a(!!r,"must specify image data");var d=c|0,l=h|0,_=p|0,t=q();return g(t,y),t.width=0,t.height=0,$(t,r),t.width=t.width||(y.width>>_)-d,t.height=t.height||(y.height>>_)-l,a(y.type===t.type&&y.format===t.format&&y.internalformat===t.internalformat,"incompatible format for texture.subimage"),a(d>=0&&l>=0&&d+t.width<=y.width&&l+t.height<=y.height,"texture.subimage write out of bounds"),a(y.mipmask&1<<_,"missing mipmap data"),a(t.data||t.element||t.needsCopy,"missing image data"),We(y),me(t,ar,d,l,_),Te(),J(t),te}function i(r,c){var h=r|0,p=c|0||h;if(h===y.width&&p===y.height)return te;te.width=y.width=h,te.height=y.height=p,We(y);for(var d=0;y.mipmask>>d;++d){var l=h>>d,_=p>>d;if(!l||!_)break;e.texImage2D(ar,d,y.format,l,_,0,y.format,y.type,null)}return Te(),S.profile&&(y.stats.size=Ot(y.internalformat,y.type,h,p,!1,!1)),te}return te(f,A),te.subimage=_e,te.resize=i,te._reglType="texture2d",te._texture=y,S.profile&&(te.stats=y.stats),te.destroy=function(){y.decRef()},te}function Ae(f,A,y,te,_e,i){var r=new ve(on);je[r.id]=r,E.cubeCount++;var c=new Array(6);function h(l,_,t,u,o,m){var b,R=r.texInfo;for(we.call(R),b=0;b<6;++b)c[b]=Ee();if(typeof l=="number"||!l){var U=l|0||1;for(b=0;b<6;++b)de(c[b],U,U)}else if(typeof l=="object")if(_)be(c[0],l),be(c[1],_),be(c[2],t),be(c[3],u),be(c[4],o),be(c[5],m);else if(Be(R,l),ne(r,l),"faces"in l){var H=l.faces;for(a(Array.isArray(H)&&H.length===6,"cube faces must be a length 6 array"),b=0;b<6;++b)a(typeof H[b]=="object"&&!!H[b],"invalid input for cube map face"),g(c[b],r),be(c[b],H[b])}else for(b=0;b<6;++b)be(c[b],l);else a.raise("invalid arguments to cube map");for(g(r,c[0]),a.optional(function(){s.npotTextureCube||a(Ga(r.width)&&Ga(r.height),"your browser does not support non power or two texture dimensions")}),R.genMipmaps?r.mipmask=(c[0].width<<1)-1:r.mipmask=c[0].mipmask,a.textureCube(r,R,c,s),r.internalformat=c[0].internalformat,h.width=c[0].width,h.height=c[0].height,We(r),b=0;b<6;++b)Le(c[b],At+b);for(ke(R,on),Te(),S.profile&&(r.stats.size=Ot(r.internalformat,r.type,h.width,h.height,R.genMipmaps,!0)),h.format=P[r.internalformat],h.type=ee[r.type],h.mag=O[R.magFilter],h.min=Z[R.minFilter],h.wrapS=Y[R.wrapS],h.wrapT=Y[R.wrapT],b=0;b<6;++b)Ie(c[b]);return h}function p(l,_,t,u,o){a(!!_,"must specify image data"),a(typeof l=="number"&&l===(l|0)&&l>=0&&l<6,"invalid face");var m=t|0,b=u|0,R=o|0,U=q();return g(U,r),U.width=0,U.height=0,$(U,_),U.width=U.width||(r.width>>R)-m,U.height=U.height||(r.height>>R)-b,a(r.type===U.type&&r.format===U.format&&r.internalformat===U.internalformat,"incompatible format for texture.subimage"),a(m>=0&&b>=0&&m+U.width<=r.width&&b+U.height<=r.height,"texture.subimage write out of bounds"),a(r.mipmask&1<<R,"missing mipmap data"),a(U.data||U.element||U.needsCopy,"missing image data"),We(r),me(U,At+l,m,b,R),Te(),J(U),h}function d(l){var _=l|0;if(_!==r.width){h.width=r.width=_,h.height=r.height=_,We(r);for(var t=0;t<6;++t)for(var u=0;r.mipmask>>u;++u)e.texImage2D(At+t,u,r.format,_>>u,_>>u,0,r.format,r.type,null);return Te(),S.profile&&(r.stats.size=Ot(r.internalformat,r.type,h.width,h.height,!1,!0)),h}}return h(f,A,y,te,_e,i),h.subimage=p,h.resize=d,h._reglType="textureCube",h._texture=r,S.profile&&(h.stats=r.stats),h.destroy=function(){r.decRef()},h}function Fe(){for(var f=0;f<$e;++f)e.activeTexture(rt+f),e.bindTexture(ar,null),De[f]=null;Je(je).forEach(se),E.cubeCount=0,E.textureCount=0}S.profile&&(E.getTotalTextureSize=function(){var f=0;return Object.keys(je).forEach(function(A){f+=je[A].stats.size}),f});function fr(){for(var f=0;f<$e;++f){var A=De[f];A&&(A.bindCount=0,A.unit=-1,De[f]=null)}Je(je).forEach(function(y){y.texture=e.createTexture(),e.bindTexture(y.target,y.texture);for(var te=0;te<32;++te)if((y.mipmask&1<<te)!=0)if(y.target===ar)e.texImage2D(ar,te,y.internalformat,y.width>>te,y.height>>te,0,y.internalformat,y.type,null);else for(var _e=0;_e<6;++_e)e.texImage2D(At+_e,te,y.internalformat,y.width>>te,y.height>>te,0,y.internalformat,y.type,null);ke(y.texInfo,y.target)})}function Gr(){for(var f=0;f<$e;++f){var A=De[f];A&&(A.bindCount=0,A.unit=-1,De[f]=null),e.activeTexture(rt+f),e.bindTexture(ar,null),e.bindTexture(on,null)}}return{create2D:ye,createCube:Ae,clear:Fe,getTexture:function(f){return null},restore:fr,refresh:Gr}}var mr=36161,Rt=32854,ai=32855,ii=36194,fi=33189,oi=36168,si=34041,ui=35907,ci=34836,li=34842,di=34843,tr=[];tr[Rt]=2,tr[ai]=2,tr[ii]=2,tr[fi]=2,tr[oi]=1,tr[si]=4,tr[ui]=4,tr[ci]=16,tr[li]=8,tr[di]=6;function mi(e,n,s){return tr[e]*n*s}var au=function(e,n,s,x,w){var E={rgba4:Rt,rgb565:ii,"rgb5 a1":ai,depth:fi,stencil:oi,"depth stencil":si};n.ext_srgb&&(E.srgba=ui),n.ext_color_buffer_half_float&&(E.rgba16f=li,E.rgb16f=di),n.webgl_color_buffer_float&&(E.rgba32f=ci);var S=[];Object.keys(E).forEach(function(D){var N=E[D];S[N]=D});var G=0,C={};function B(D){this.id=G++,this.refCount=1,this.renderbuffer=D,this.format=Rt,this.width=0,this.height=0,w.profile&&(this.stats={size:0})}B.prototype.decRef=function(){--this.refCount<=0&&M(this)};function M(D){var N=D.renderbuffer;a(N,"must not double destroy renderbuffer"),e.bindRenderbuffer(mr,null),e.deleteRenderbuffer(N),D.renderbuffer=null,D.refCount=0,delete C[D.id],x.renderbufferCount--}function I(D,N){var v=new B(e.createRenderbuffer());C[v.id]=v,x.renderbufferCount++;function T(ee,O){var Z=0,Y=0,fe=Rt;if(typeof ee=="object"&&ee){var L=ee;if("shape"in L){var g=L.shape;a(Array.isArray(g)&&g.length>=2,"invalid renderbuffer shape"),Z=g[0]|0,Y=g[1]|0}else"radius"in L&&(Z=Y=L.radius|0),"width"in L&&(Z=L.width|0),"height"in L&&(Y=L.height|0);"format"in L&&(a.parameter(L.format,E,"invalid renderbuffer format"),fe=E[L.format])}else typeof ee=="number"?(Z=ee|0,typeof O=="number"?Y=O|0:Y=Z):ee?a.raise("invalid arguments to renderbuffer constructor"):Z=Y=1;if(a(Z>0&&Y>0&&Z<=s.maxRenderbufferSize&&Y<=s.maxRenderbufferSize,"invalid renderbuffer size"),!(Z===v.width&&Y===v.height&&fe===v.format))return T.width=v.width=Z,T.height=v.height=Y,v.format=fe,e.bindRenderbuffer(mr,v.renderbuffer),e.renderbufferStorage(mr,fe,Z,Y),a(e.getError()===0,"invalid render buffer format"),w.profile&&(v.stats.size=mi(v.format,v.width,v.height)),T.format=S[v.format],T}function P(ee,O){var Z=ee|0,Y=O|0||Z;return Z===v.width&&Y===v.height||(a(Z>0&&Y>0&&Z<=s.maxRenderbufferSize&&Y<=s.maxRenderbufferSize,"invalid renderbuffer size"),T.width=v.width=Z,T.height=v.height=Y,e.bindRenderbuffer(mr,v.renderbuffer),e.renderbufferStorage(mr,v.format,Z,Y),a(e.getError()===0,"invalid render buffer format"),w.profile&&(v.stats.size=mi(v.format,v.width,v.height))),T}return T(D,N),T.resize=P,T._reglType="renderbuffer",T._renderbuffer=v,w.profile&&(T.stats=v.stats),T.destroy=function(){v.decRef()},T}w.profile&&(x.getTotalRenderbufferSize=function(){var D=0;return Object.keys(C).forEach(function(N){D+=C[N].stats.size}),D});function j(){Je(C).forEach(function(D){D.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(mr,D.renderbuffer),e.renderbufferStorage(mr,D.format,D.width,D.height)}),e.bindRenderbuffer(mr,null)}return{create:I,clear:function(){Je(C).forEach(M)},restore:j}},ur=36160,Sn=36161,gr=3553,Ct=34069,hi=36064,vi=36096,pi=36128,_i=33306,bi=36053,iu=36054,fu=36055,ou=36057,su=36061,uu=36193,cu=5121,lu=5126,yi=6407,Ei=6408,du=6402,mu=[yi,Ei],gn=[];gn[Ei]=4,gn[yi]=3;var Gt=[];Gt[cu]=1,Gt[lu]=4,Gt[uu]=2;var hu=32854,vu=32855,pu=36194,_u=33189,bu=36168,xi=34041,yu=35907,Eu=34836,xu=34842,Au=34843,Tu=[hu,vu,pu,yu,xu,Au,Eu],Vr={};Vr[bi]="complete",Vr[iu]="incomplete attachment",Vr[ou]="incomplete dimensions",Vr[fu]="incomplete, missing attachment",Vr[su]="unsupported";function Su(e,n,s,x,w,E){var S={cur:null,next:null,dirty:!1,setFBO:null},G=["rgba"],C=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&C.push("srgba"),n.ext_color_buffer_half_float&&C.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&C.push("rgba32f");var B=["uint8"];n.oes_texture_half_float&&B.push("half float","float16"),n.oes_texture_float&&B.push("float","float32");function M(F,$,W){this.target=F,this.texture=$,this.renderbuffer=W;var me=0,le=0;$?(me=$.width,le=$.height):W&&(me=W.width,le=W.height),this.width=me,this.height=le}function I(F){F&&(F.texture&&F.texture._texture.decRef(),F.renderbuffer&&F.renderbuffer._renderbuffer.decRef())}function j(F,$,W){if(!!F)if(F.texture){var me=F.texture._texture,le=Math.max(1,me.width),q=Math.max(1,me.height);a(le===$&&q===W,"inconsistent width/height for supplied texture"),me.refCount+=1}else{var J=F.renderbuffer._renderbuffer;a(J.width===$&&J.height===W,"inconsistent width/height for renderbuffer"),J.refCount+=1}}function D(F,$){$&&($.texture?e.framebufferTexture2D(ur,F,$.target,$.texture._texture.texture,0):e.framebufferRenderbuffer(ur,F,Sn,$.renderbuffer._renderbuffer.renderbuffer))}function N(F){var $=gr,W=null,me=null,le=F;typeof F=="object"&&(le=F.data,"target"in F&&($=F.target|0)),a.type(le,"function","invalid attachment data");var q=le._reglType;return q==="texture2d"?(W=le,a($===gr)):q==="textureCube"?(W=le,a($>=Ct&&$<Ct+6,"invalid cube map target")):q==="renderbuffer"?(me=le,$=Sn):a.raise("invalid regl object for attachment"),new M($,W,me)}function v(F,$,W,me,le){if(W){var q=x.create2D({width:F,height:$,format:me,type:le});return q._texture.refCount=0,new M(gr,q,null)}else{var J=w.create({width:F,height:$,format:me});return J._renderbuffer.refCount=0,new M(Sn,null,J)}}function T(F){return F&&(F.texture||F.renderbuffer)}function P(F,$,W){F&&(F.texture?F.texture.resize($,W):F.renderbuffer&&F.renderbuffer.resize($,W),F.width=$,F.height=W)}var ee=0,O={};function Z(){this.id=ee++,O[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Y(F){F.colorAttachments.forEach(I),I(F.depthAttachment),I(F.stencilAttachment),I(F.depthStencilAttachment)}function fe(F){var $=F.framebuffer;a($,"must not double destroy framebuffer"),e.deleteFramebuffer($),F.framebuffer=null,E.framebufferCount--,delete O[F.id]}function L(F){var $;e.bindFramebuffer(ur,F.framebuffer);var W=F.colorAttachments;for($=0;$<W.length;++$)D(hi+$,W[$]);for($=W.length;$<s.maxColorAttachments;++$)e.framebufferTexture2D(ur,hi+$,gr,null,0);e.framebufferTexture2D(ur,_i,gr,null,0),e.framebufferTexture2D(ur,vi,gr,null,0),e.framebufferTexture2D(ur,pi,gr,null,0),D(vi,F.depthAttachment),D(pi,F.stencilAttachment),D(_i,F.depthStencilAttachment);var me=e.checkFramebufferStatus(ur);!e.isContextLost()&&me!==bi&&a.raise("framebuffer configuration not supported, status = "+Vr[me]),e.bindFramebuffer(ur,S.next?S.next.framebuffer:null),S.cur=S.next,e.getError()}function g(F,$){var W=new Z;E.framebufferCount++;function me(q,J){var ue;a(S.next!==W,"can not update framebuffer which is currently in use");var de=0,be=0,Le=!0,Re=!0,Ee=null,Ie=!0,we="rgba",Be="uint8",ke=1,Me=null,je=null,$e=null,De=!1;if(typeof q=="number")de=q|0,be=J|0||de;else if(!q)de=be=1;else{a.type(q,"object","invalid arguments for framebuffer");var ve=q;if("shape"in ve){var We=ve.shape;a(Array.isArray(We)&&We.length>=2,"invalid shape for framebuffer"),de=We[0],be=We[1]}else"radius"in ve&&(de=be=ve.radius),"width"in ve&&(de=ve.width),"height"in ve&&(be=ve.height);("color"in ve||"colors"in ve)&&(Ee=ve.color||ve.colors,Array.isArray(Ee)&&a(Ee.length===1||n.webgl_draw_buffers,"multiple render targets not supported")),Ee||("colorCount"in ve&&(ke=ve.colorCount|0,a(ke>0,"invalid color buffer count")),"colorTexture"in ve&&(Ie=!!ve.colorTexture,we="rgba4"),"colorType"in ve&&(Be=ve.colorType,Ie?(a(n.oes_texture_float||!(Be==="float"||Be==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),a(n.oes_texture_half_float||!(Be==="half float"||Be==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Be==="half float"||Be==="float16"?(a(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),we="rgba16f"):(Be==="float"||Be==="float32")&&(a(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),we="rgba32f"),a.oneOf(Be,B,"invalid color type")),"colorFormat"in ve&&(we=ve.colorFormat,G.indexOf(we)>=0?Ie=!0:C.indexOf(we)>=0?Ie=!1:a.optional(function(){Ie?a.oneOf(ve.colorFormat,G,"invalid color format for texture"):a.oneOf(ve.colorFormat,C,"invalid color format for renderbuffer")}))),("depthTexture"in ve||"depthStencilTexture"in ve)&&(De=!!(ve.depthTexture||ve.depthStencilTexture),a(!De||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ve&&(typeof ve.depth=="boolean"?Le=ve.depth:(Me=ve.depth,Re=!1)),"stencil"in ve&&(typeof ve.stencil=="boolean"?Re=ve.stencil:(je=ve.stencil,Le=!1)),"depthStencil"in ve&&(typeof ve.depthStencil=="boolean"?Le=Re=ve.depthStencil:($e=ve.depthStencil,Le=!1,Re=!1))}var Te=null,se=null,ye=null,Ae=null;if(Array.isArray(Ee))Te=Ee.map(N);else if(Ee)Te=[N(Ee)];else for(Te=new Array(ke),ue=0;ue<ke;++ue)Te[ue]=v(de,be,Ie,we,Be);a(n.webgl_draw_buffers||Te.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),a(Te.length<=s.maxColorAttachments,"too many color attachments, not supported"),de=de||Te[0].width,be=be||Te[0].height,Me?se=N(Me):Le&&!Re&&(se=v(de,be,De,"depth","uint32")),je?ye=N(je):Re&&!Le&&(ye=v(de,be,!1,"stencil","uint8")),$e?Ae=N($e):!Me&&!je&&Re&&Le&&(Ae=v(de,be,De,"depth stencil","depth stencil")),a(!!Me+!!je+!!$e<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Fe=null;for(ue=0;ue<Te.length;++ue)if(j(Te[ue],de,be),a(!Te[ue]||Te[ue].texture&&mu.indexOf(Te[ue].texture._texture.format)>=0||Te[ue].renderbuffer&&Tu.indexOf(Te[ue].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ue+" is invalid"),Te[ue]&&Te[ue].texture){var fr=gn[Te[ue].texture._texture.format]*Gt[Te[ue].texture._texture.type];Fe===null?Fe=fr:a(Fe===fr,"all color attachments much have the same number of bits per pixel.")}return j(se,de,be),a(!se||se.texture&&se.texture._texture.format===du||se.renderbuffer&&se.renderbuffer._renderbuffer.format===_u,"invalid depth attachment for framebuffer object"),j(ye,de,be),a(!ye||ye.renderbuffer&&ye.renderbuffer._renderbuffer.format===bu,"invalid stencil attachment for framebuffer object"),j(Ae,de,be),a(!Ae||Ae.texture&&Ae.texture._texture.format===xi||Ae.renderbuffer&&Ae.renderbuffer._renderbuffer.format===xi,"invalid depth-stencil attachment for framebuffer object"),Y(W),W.width=de,W.height=be,W.colorAttachments=Te,W.depthAttachment=se,W.stencilAttachment=ye,W.depthStencilAttachment=Ae,me.color=Te.map(T),me.depth=T(se),me.stencil=T(ye),me.depthStencil=T(Ae),me.width=W.width,me.height=W.height,L(W),me}function le(q,J){a(S.next!==W,"can not resize a framebuffer which is currently in use");var ue=Math.max(q|0,1),de=Math.max(J|0||ue,1);if(ue===W.width&&de===W.height)return me;for(var be=W.colorAttachments,Le=0;Le<be.length;++Le)P(be[Le],ue,de);return P(W.depthAttachment,ue,de),P(W.stencilAttachment,ue,de),P(W.depthStencilAttachment,ue,de),W.width=me.width=ue,W.height=me.height=de,L(W),me}return me(F,$),ce(me,{resize:le,_reglType:"framebuffer",_framebuffer:W,destroy:function(){fe(W),Y(W)},use:function(q){S.setFBO({framebuffer:me},q)}})}function ne(F){var $=Array(6);function W(le){var q;a($.indexOf(S.next)<0,"can not update framebuffer which is currently in use");var J={color:null},ue=0,de=null,be="rgba",Le="uint8",Re=1;if(typeof le=="number")ue=le|0;else if(!le)ue=1;else{a.type(le,"object","invalid arguments for framebuffer");var Ee=le;if("shape"in Ee){var Ie=Ee.shape;a(Array.isArray(Ie)&&Ie.length>=2,"invalid shape for framebuffer"),a(Ie[0]===Ie[1],"cube framebuffer must be square"),ue=Ie[0]}else"radius"in Ee&&(ue=Ee.radius|0),"width"in Ee?(ue=Ee.width|0,"height"in Ee&&a(Ee.height===ue,"must be square")):"height"in Ee&&(ue=Ee.height|0);("color"in Ee||"colors"in Ee)&&(de=Ee.color||Ee.colors,Array.isArray(de)&&a(de.length===1||n.webgl_draw_buffers,"multiple render targets not supported")),de||("colorCount"in Ee&&(Re=Ee.colorCount|0,a(Re>0,"invalid color buffer count")),"colorType"in Ee&&(a.oneOf(Ee.colorType,B,"invalid color type"),Le=Ee.colorType),"colorFormat"in Ee&&(be=Ee.colorFormat,a.oneOf(Ee.colorFormat,G,"invalid color format for texture"))),"depth"in Ee&&(J.depth=Ee.depth),"stencil"in Ee&&(J.stencil=Ee.stencil),"depthStencil"in Ee&&(J.depthStencil=Ee.depthStencil)}var we;if(de)if(Array.isArray(de))for(we=[],q=0;q<de.length;++q)we[q]=de[q];else we=[de];else{we=Array(Re);var Be={radius:ue,format:be,type:Le};for(q=0;q<Re;++q)we[q]=x.createCube(Be)}for(J.color=Array(we.length),q=0;q<we.length;++q){var ke=we[q];a(typeof ke=="function"&&ke._reglType==="textureCube","invalid cube map"),ue=ue||ke.width,a(ke.width===ue&&ke.height===ue,"invalid cube map shape"),J.color[q]={target:Ct,data:we[q]}}for(q=0;q<6;++q){for(var Me=0;Me<we.length;++Me)J.color[Me].target=Ct+q;q>0&&(J.depth=$[0].depth,J.stencil=$[0].stencil,J.depthStencil=$[0].depthStencil),$[q]?$[q](J):$[q]=g(J)}return ce(W,{width:ue,height:ue,color:we})}function me(le){var q,J=le|0;if(a(J>0&&J<=s.maxCubeMapSize,"invalid radius for cube fbo"),J===W.width)return W;var ue=W.color;for(q=0;q<ue.length;++q)ue[q].resize(J);for(q=0;q<6;++q)$[q].resize(J);return W.width=W.height=J,W}return W(F),ce(W,{faces:$,resize:me,_reglType:"framebufferCube",destroy:function(){$.forEach(function(le){le.destroy()})}})}function X(){S.cur=null,S.next=null,S.dirty=!0,Je(O).forEach(function(F){F.framebuffer=e.createFramebuffer(),L(F)})}return ce(S,{getFramebuffer:function(F){if(typeof F=="function"&&F._reglType==="framebuffer"){var $=F._framebuffer;if($ instanceof Z)return $}return null},create:g,createCube:ne,clear:function(){Je(O).forEach(fe)},restore:X})}var gu=5126,Ai=34962,Dt=34963,Ti=["attributes","elements","offset","count","primitive","instances"];function wn(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=gu,this.offset=0,this.stride=0,this.divisor=0}function wu(e,n,s,x,w,E,S){for(var G=s.maxAttributes,C=new Array(G),B=0;B<G;++B)C[B]=new wn;var M=0,I={},j={Record:wn,scope:{},state:C,currentVAO:null,targetVAO:null,restore:N()?Y:function(){},createVAO:fe,getVAO:T,destroyBuffer:D,setVAO:N()?P:ee,clear:N()?O:function(){}};function D(L){for(var g=0;g<C.length;++g){var ne=C[g];ne.buffer===L&&(e.disableVertexAttribArray(g),ne.buffer=null)}}function N(){return n.oes_vertex_array_object}function v(){return n.angle_instanced_arrays}function T(L){return typeof L=="function"&&L._vao?L._vao:null}function P(L){if(L!==j.currentVAO){var g=N();L?g.bindVertexArrayOES(L.vao):g.bindVertexArrayOES(null),j.currentVAO=L}}function ee(L){if(L!==j.currentVAO){if(L)L.bindAttrs();else{for(var g=v(),ne=0;ne<C.length;++ne){var X=C[ne];X.buffer?(e.enableVertexAttribArray(ne),X.buffer.bind(),e.vertexAttribPointer(ne,X.size,X.type,X.normalized,X.stride,X.offfset),g&&X.divisor&&g.vertexAttribDivisorANGLE(ne,X.divisor)):(e.disableVertexAttribArray(ne),e.vertexAttrib4f(ne,X.x,X.y,X.z,X.w))}S.elements?e.bindBuffer(Dt,S.elements.buffer.buffer):e.bindBuffer(Dt,null)}j.currentVAO=L}}function O(){Je(I).forEach(function(L){L.destroy()})}function Z(){this.id=++M,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var L=N();L?this.vao=L.createVertexArrayOES():this.vao=null,I[this.id]=this,this.buffers=[]}Z.prototype.bindAttrs=function(){for(var L=v(),g=this.attributes,ne=0;ne<g.length;++ne){var X=g[ne];X.buffer?(e.enableVertexAttribArray(ne),e.bindBuffer(Ai,X.buffer.buffer),e.vertexAttribPointer(ne,X.size,X.type,X.normalized,X.stride,X.offset),L&&X.divisor&&L.vertexAttribDivisorANGLE(ne,X.divisor)):(e.disableVertexAttribArray(ne),e.vertexAttrib4f(ne,X.x,X.y,X.z,X.w))}for(var F=g.length;F<G;++F)e.disableVertexAttribArray(F);var $=E.getElements(this.elements);$?e.bindBuffer(Dt,$.buffer.buffer):e.bindBuffer(Dt,null)},Z.prototype.refresh=function(){var L=N();L&&(L.bindVertexArrayOES(this.vao),this.bindAttrs(),j.currentVAO=this)},Z.prototype.destroy=function(){if(this.vao){var L=N();this===j.currentVAO&&(j.currentVAO=null,L.bindVertexArrayOES(null)),L.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),I[this.id]&&(delete I[this.id],x.vaoCount-=1)};function Y(){var L=N();L&&Je(I).forEach(function(g){g.refresh()})}function fe(L){var g=new Z;x.vaoCount+=1;function ne(X){var F;if(Array.isArray(X))F=X,g.elements&&g.ownsElements&&g.elements.destroy(),g.elements=null,g.ownsElements=!1,g.offset=0,g.count=0,g.instances=-1,g.primitive=4;else{if(a(typeof X=="object","invalid arguments for create vao"),a("attributes"in X,"must specify attributes for vao"),X.elements){var $=X.elements;g.ownsElements?typeof $=="function"&&$._reglType==="elements"?(g.elements.destroy(),g.ownsElements=!1):(g.elements($),g.ownsElements=!1):E.getElements(X.elements)?(g.elements=X.elements,g.ownsElements=!1):(g.elements=E.create(X.elements),g.ownsElements=!0)}else g.elements=null,g.ownsElements=!1;F=X.attributes,g.offset=0,g.count=-1,g.instances=-1,g.primitive=4,g.elements&&(g.count=g.elements._elements.vertCount,g.primitive=g.elements._elements.primType),"offset"in X&&(g.offset=X.offset|0),"count"in X&&(g.count=X.count|0),"instances"in X&&(g.instances=X.instances|0),"primitive"in X&&(a(X.primitive in dr,"bad primitive type: "+X.primitive),g.primitive=dr[X.primitive]),a.optional(()=>{for(var Le=Object.keys(X),Re=0;Re<Le.length;++Re)a(Ti.indexOf(Le[Re])>=0,'invalid option for vao: "'+Le[Re]+'" valid options are '+Ti)}),a(Array.isArray(F),"attributes must be an array")}a(F.length<G,"too many attributes"),a(F.length>0,"must specify at least one attribute");var W={},me=g.attributes;me.length=F.length;for(var le=0;le<F.length;++le){var q=F[le],J=me[le]=new wn,ue=q.data||q;if(Array.isArray(ue)||K(ue)||rr(ue)){var de;g.buffers[le]&&(de=g.buffers[le],K(ue)&&de._buffer.byteLength>=ue.byteLength?de.subdata(ue):(de.destroy(),g.buffers[le]=null)),g.buffers[le]||(de=g.buffers[le]=w.create(q,Ai,!1,!0)),J.buffer=w.getBuffer(de),J.size=J.buffer.dimension|0,J.normalized=!1,J.type=J.buffer.dtype,J.offset=0,J.stride=0,J.divisor=0,J.state=1,W[le]=1}else w.getBuffer(q)?(J.buffer=w.getBuffer(q),J.size=J.buffer.dimension|0,J.normalized=!1,J.type=J.buffer.dtype,J.offset=0,J.stride=0,J.divisor=0,J.state=1):w.getBuffer(q.buffer)?(J.buffer=w.getBuffer(q.buffer),J.size=(+q.size||J.buffer.dimension)|0,J.normalized=!!q.normalized||!1,"type"in q?(a.parameter(q.type,xr,"invalid buffer type"),J.type=xr[q.type]):J.type=J.buffer.dtype,J.offset=(q.offset||0)|0,J.stride=(q.stride||0)|0,J.divisor=(q.divisor||0)|0,J.state=1,a(J.size>=1&&J.size<=4,"size must be between 1 and 4"),a(J.offset>=0,"invalid offset"),a(J.stride>=0&&J.stride<=255,"stride must be between 0 and 255"),a(J.divisor>=0,"divisor must be positive"),a(!J.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in q?(a(le>0,"first attribute must not be a constant"),J.x=+q.x||0,J.y=+q.y||0,J.z=+q.z||0,J.w=+q.w||0,J.state=2):a(!1,"invalid attribute spec for location "+le)}for(var be=0;be<g.buffers.length;++be)!W[be]&&g.buffers[be]&&(g.buffers[be].destroy(),g.buffers[be]=null);return g.refresh(),ne}return ne.destroy=function(){for(var X=0;X<g.buffers.length;++X)g.buffers[X]&&g.buffers[X].destroy();g.buffers.length=0,g.ownsElements&&(g.elements.destroy(),g.elements=null,g.ownsElements=!1),g.destroy()},ne._vao=g,ne._reglType="vao",ne(L)}return j}var Si=35632,Lu=35633,Ou=35718,Ru=35721;function Cu(e,n,s,x){var w={},E={};function S(v,T,P,ee){this.name=v,this.id=T,this.location=P,this.info=ee}function G(v,T){for(var P=0;P<v.length;++P)if(v[P].id===T.id){v[P].location=T.location;return}v.push(T)}function C(v,T,P){var ee=v===Si?w:E,O=ee[T];if(!O){var Z=n.str(T);O=e.createShader(v),e.shaderSource(O,Z),e.compileShader(O),a.shaderError(e,O,Z,v,P),ee[T]=O}return O}var B={},M=[],I=0;function j(v,T){this.id=I++,this.fragId=v,this.vertId=T,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,x.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function D(v,T,P){var ee,O,Z=C(Si,v.fragId),Y=C(Lu,v.vertId),fe=v.program=e.createProgram();if(e.attachShader(fe,Z),e.attachShader(fe,Y),P)for(ee=0;ee<P.length;++ee){var L=P[ee];e.bindAttribLocation(fe,L[0],L[1])}e.linkProgram(fe),a.linkError(e,fe,n.str(v.fragId),n.str(v.vertId),T);var g=e.getProgramParameter(fe,Ou);x.profile&&(v.stats.uniformsCount=g);var ne=v.uniforms;for(ee=0;ee<g;++ee)if(O=e.getActiveUniform(fe,ee),O)if(O.size>1)for(var X=0;X<O.size;++X){var F=O.name.replace("[0]","["+X+"]");G(ne,new S(F,n.id(F),e.getUniformLocation(fe,F),O))}else G(ne,new S(O.name,n.id(O.name),e.getUniformLocation(fe,O.name),O));var $=e.getProgramParameter(fe,Ru);x.profile&&(v.stats.attributesCount=$);var W=v.attributes;for(ee=0;ee<$;++ee)O=e.getActiveAttrib(fe,ee),O&&G(W,new S(O.name,n.id(O.name),e.getAttribLocation(fe,O.name),O))}x.profile&&(s.getMaxUniformsCount=function(){var v=0;return M.forEach(function(T){T.stats.uniformsCount>v&&(v=T.stats.uniformsCount)}),v},s.getMaxAttributesCount=function(){var v=0;return M.forEach(function(T){T.stats.attributesCount>v&&(v=T.stats.attributesCount)}),v});function N(){w={},E={};for(var v=0;v<M.length;++v)D(M[v],null,M[v].attributes.map(function(T){return[T.location,T.name]}))}return{clear:function(){var v=e.deleteShader.bind(e);Je(w).forEach(v),w={},Je(E).forEach(v),E={},M.forEach(function(T){e.deleteProgram(T.program)}),M.length=0,B={},s.shaderCount=0},program:function(v,T,P,ee){a.command(v>=0,"missing vertex shader",P),a.command(T>=0,"missing fragment shader",P);var O=B[T];O||(O=B[T]={});var Z=O[v];if(Z&&(Z.refCount++,!ee))return Z;var Y=new j(T,v);return s.shaderCount++,D(Y,P,ee),Z||(O[v]=Y),M.push(Y),ce(Y,{destroy:function(){if(Y.refCount--,Y.refCount<=0){e.deleteProgram(Y.program);var fe=M.indexOf(Y);M.splice(fe,1),s.shaderCount--}O[Y.vertId].refCount<=0&&(e.deleteShader(E[Y.vertId]),delete E[Y.vertId],delete B[Y.fragId][Y.vertId]),Object.keys(B[Y.fragId]).length||(e.deleteShader(w[Y.fragId]),delete w[Y.fragId],delete B[Y.fragId])}})},restore:N,shader:C,frag:-1,vert:-1}}var Gu=6408,tt=5121,Du=3333,Ft=5126;function Fu(e,n,s,x,w,E,S){function G(M){var I;n.next===null?(a(w.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),I=tt):(a(n.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),I=n.next.colorAttachments[0].texture._texture.type,a.optional(function(){E.oes_texture_float?(a(I===tt||I===Ft,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),I===Ft&&a(S.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):a(I===tt,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var j=0,D=0,N=x.framebufferWidth,v=x.framebufferHeight,T=null;K(M)?T=M:M&&(a.type(M,"object","invalid arguments to regl.read()"),j=M.x|0,D=M.y|0,a(j>=0&&j<x.framebufferWidth,"invalid x offset for regl.read"),a(D>=0&&D<x.framebufferHeight,"invalid y offset for regl.read"),N=(M.width||x.framebufferWidth-j)|0,v=(M.height||x.framebufferHeight-D)|0,T=M.data||null),T&&(I===tt?a(T instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):I===Ft&&a(T instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),a(N>0&&N+j<=x.framebufferWidth,"invalid width for read pixels"),a(v>0&&v+D<=x.framebufferHeight,"invalid height for read pixels"),s();var P=N*v*4;return T||(I===tt?T=new Uint8Array(P):I===Ft&&(T=T||new Float32Array(P))),a.isTypedArray(T,"data buffer for regl.read() must be a typedarray"),a(T.byteLength>=P,"data buffer for regl.read() too small"),e.pixelStorei(Du,4),e.readPixels(j,D,N,v,Gu,I,T),T}function C(M){var I;return n.setFBO({framebuffer:M.framebuffer},function(){I=G(M)}),I}function B(M){return!M||!("framebuffer"in M)?G(M):C(M)}return B}function zr(e){return Array.prototype.slice.call(e)}function Hr(e){return zr(e).join("")}function Pu(){var e=0,n=[],s=[];function x(I){for(var j=0;j<s.length;++j)if(s[j]===I)return n[j];var D="g"+e++;return n.push(D),s.push(I),D}function w(){var I=[];function j(){I.push.apply(I,zr(arguments))}var D=[];function N(){var v="v"+e++;return D.push(v),arguments.length>0&&(I.push(v,"="),I.push.apply(I,zr(arguments)),I.push(";")),v}return ce(j,{def:N,toString:function(){return Hr([D.length>0?"var "+D.join(",")+";":"",Hr(I)])}})}function E(){var I=w(),j=w(),D=I.toString,N=j.toString;function v(T,P){j(T,P,"=",I.def(T,P),";")}return ce(function(){I.apply(I,zr(arguments))},{def:I.def,entry:I,exit:j,save:v,set:function(T,P,ee){v(T,P),I(T,P,"=",ee,";")},toString:function(){return D()+N()}})}function S(){var I=Hr(arguments),j=E(),D=E(),N=j.toString,v=D.toString;return ce(j,{then:function(){return j.apply(j,zr(arguments)),this},else:function(){return D.apply(D,zr(arguments)),this},toString:function(){var T=v();return T&&(T="else{"+T+"}"),Hr(["if(",I,"){",N(),"}",T])}})}var G=w(),C={};function B(I,j){var D=[];function N(){var O="a"+D.length;return D.push(O),O}j=j||0;for(var v=0;v<j;++v)N();var T=E(),P=T.toString,ee=C[I]=ce(T,{arg:N,toString:function(){return Hr(["function(",D.join(),"){",P(),"}"])}});return ee}function M(){var I=['"use strict";',G,"return {"];Object.keys(C).forEach(function(N){I.push('"',N,'":',C[N].toString(),",")}),I.push("}");var j=Hr(I).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),D=Function.apply(null,n.concat(j));return D.apply(null,s)}return{global:G,link:x,block:w,proc:B,scope:E,cond:S,compile:M}}var jr="xyzw".split(""),gi=5121,Xr=1,Ln=2,On=0,Rn=1,Cn=2,Gn=3,Pt=4,wi=5,Li=6,Oi="dither",Ri="blend.enable",Ci="blend.color",Dn="blend.equation",Fn="blend.func",Gi="depth.enable",Di="depth.func",Fi="depth.range",Pi="depth.mask",Pn="colorMask",Ni="cull.enable",Bi="cull.face",Nn="frontFace",Bn="lineWidth",Ii="polygonOffset.enable",In="polygonOffset.offset",ki="sample.alpha",Mi="sample.enable",kn="sample.coverage",Ui="stencil.enable",Vi="stencil.mask",Mn="stencil.func",Un="stencil.opFront",nt="stencil.opBack",zi="scissor.enable",Nt="scissor.box",cr="viewport",at="profile",wr="framebuffer",it="vert",ft="frag",Lr="elements",Or="primitive",Rr="count",Bt="offset",It="instances",ot="vao",Vn="Width",zn="Height",$r=wr+Vn,Wr=wr+zn,Nu=cr+Vn,Bu=cr+zn,Hi="drawingBuffer",ji=Hi+Vn,Xi=Hi+zn,Iu=[Fn,Dn,Mn,Un,nt,kn,cr,Nt,In],Yr=34962,Hn=34963,ku=35632,Mu=35633,$i=3553,Uu=34067,Vu=2884,zu=3042,Hu=3024,ju=2960,Xu=2929,$u=3089,Wu=32823,Yu=32926,qu=32928,jn=5126,kt=35664,Mt=35665,Ut=35666,Xn=5124,Vt=35667,zt=35668,Ht=35669,$n=35670,jt=35671,Xt=35672,$t=35673,st=35674,ut=35675,ct=35676,lt=35678,dt=35680,Wn=4,mt=1028,Cr=1029,Wi=2304,Yn=2305,Qu=32775,Ku=32776,Zu=519,hr=7680,Yi=0,qi=1,Qi=32774,Ju=513,Ki=36160,ec=36064,ir={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Zi=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],qr={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},vr={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ji={frag:ku,vert:Mu},qn={cw:Wi,ccw:Yn};function Wt(e){return Array.isArray(e)||K(e)||rr(e)}function ef(e){return e.sort(function(n,s){return n===cr?-1:s===cr?1:n<s?-1:1})}function ze(e,n,s,x){this.thisDep=e,this.contextDep=n,this.propDep=s,this.append=x}function pr(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Ge(e){return new ze(!1,!1,!1,e)}function qe(e,n){var s=e.type;if(s===On){var x=e.data.length;return new ze(!0,x>=1,x>=2,n)}else if(s===Pt){var w=e.data;return new ze(w.thisDep,w.contextDep,w.propDep,n)}else{if(s===wi)return new ze(!1,!1,!1,n);if(s===Li){for(var E=!1,S=!1,G=!1,C=0;C<e.data.length;++C){var B=e.data[C];if(B.type===Rn)G=!0;else if(B.type===Cn)S=!0;else if(B.type===Gn)E=!0;else if(B.type===On){E=!0;var M=B.data;M>=1&&(S=!0),M>=2&&(G=!0)}else B.type===Pt&&(E=E||B.data.thisDep,S=S||B.data.contextDep,G=G||B.data.propDep)}return new ze(E,S,G,n)}else return new ze(s===Gn,s===Cn,s===Rn,n)}}var rf=new ze(!1,!1,!1,function(){});function rc(e,n,s,x,w,E,S,G,C,B,M,I,j,D,N){var v=B.Record,T={add:32774,subtract:32778,"reverse subtract":32779};s.ext_blend_minmax&&(T.min=Qu,T.max=Ku);var P=s.angle_instanced_arrays,ee=s.webgl_draw_buffers,O=s.oes_vertex_array_object,Z={dirty:!0,profile:N.profile},Y={},fe=[],L={},g={};function ne(i){return i.replace(".","_")}function X(i,r,c){var h=ne(i);fe.push(i),Y[h]=Z[h]=!!c,L[h]=r}function F(i,r,c){var h=ne(i);fe.push(i),Array.isArray(c)?(Z[h]=c.slice(),Y[h]=c.slice()):Z[h]=Y[h]=c,g[h]=r}X(Oi,Hu),X(Ri,zu),F(Ci,"blendColor",[0,0,0,0]),F(Dn,"blendEquationSeparate",[Qi,Qi]),F(Fn,"blendFuncSeparate",[qi,Yi,qi,Yi]),X(Gi,Xu,!0),F(Di,"depthFunc",Ju),F(Fi,"depthRange",[0,1]),F(Pi,"depthMask",!0),F(Pn,Pn,[!0,!0,!0,!0]),X(Ni,Vu),F(Bi,"cullFace",Cr),F(Nn,Nn,Yn),F(Bn,Bn,1),X(Ii,Wu),F(In,"polygonOffset",[0,0]),X(ki,Yu),X(Mi,qu),F(kn,"sampleCoverage",[1,!1]),X(Ui,ju),F(Vi,"stencilMask",-1),F(Mn,"stencilFunc",[Zu,0,-1]),F(Un,"stencilOpSeparate",[mt,hr,hr,hr]),F(nt,"stencilOpSeparate",[Cr,hr,hr,hr]),X(zi,$u),F(Nt,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),F(cr,cr,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var $={gl:e,context:j,strings:n,next:Y,current:Z,draw:I,elements:E,buffer:w,shader:M,attributes:B.state,vao:B,uniforms:C,framebuffer:G,extensions:s,timer:D,isBufferArgs:Wt},W={primTypes:dr,compareFuncs:qr,blendFuncs:ir,blendEquations:T,stencilOps:vr,glTypes:xr,orientationType:qn};a.optional(function(){$.isArrayLike=Ce}),ee&&(W.backBuffer=[Cr],W.drawBuffer=Ze(x.maxDrawbuffers,function(i){return i===0?[0]:Ze(i,function(r){return ec+r})}));var me=0;function le(){var i=Pu(),r=i.link,c=i.global;i.id=me++,i.batchId="0";var h=r($),p=i.shared={props:"a0"};Object.keys($).forEach(function(u){p[u]=c.def(h,".",u)}),a.optional(function(){i.CHECK=r(a),i.commandStr=a.guessCommand(),i.command=r(i.commandStr),i.assert=function(u,o,m){u("if(!(",o,"))",this.CHECK,".commandRaise(",r(m),",",this.command,");")},W.invalidBlendCombinations=Zi});var d=i.next={},l=i.current={};Object.keys(g).forEach(function(u){Array.isArray(Z[u])&&(d[u]=c.def(p.next,".",u),l[u]=c.def(p.current,".",u))});var _=i.constants={};Object.keys(W).forEach(function(u){_[u]=c.def(JSON.stringify(W[u]))}),i.invoke=function(u,o){switch(o.type){case On:var m=["this",p.context,p.props,i.batchId];return u.def(r(o.data),".call(",m.slice(0,Math.max(o.data.length+1,4)),")");case Rn:return u.def(p.props,o.data);case Cn:return u.def(p.context,o.data);case Gn:return u.def("this",o.data);case Pt:return o.data.append(i,u),o.data.ref;case wi:return o.data.toString();case Li:return o.data.map(function(b){return i.invoke(u,b)})}},i.attribCache={};var t={};return i.scopeAttrib=function(u){var o=n.id(u);if(o in t)return t[o];var m=B.scope[o];m||(m=B.scope[o]=new v);var b=t[o]=r(m);return b},i}function q(i){var r=i.static,c=i.dynamic,h;if(at in r){var p=!!r[at];h=Ge(function(l,_){return p}),h.enable=p}else if(at in c){var d=c[at];h=qe(d,function(l,_){return l.invoke(_,d)})}return h}function J(i,r){var c=i.static,h=i.dynamic;if(wr in c){var p=c[wr];return p?(p=G.getFramebuffer(p),a.command(p,"invalid framebuffer object"),Ge(function(l,_){var t=l.link(p),u=l.shared;_.set(u.framebuffer,".next",t);var o=u.context;return _.set(o,"."+$r,t+".width"),_.set(o,"."+Wr,t+".height"),t})):Ge(function(l,_){var t=l.shared;_.set(t.framebuffer,".next","null");var u=t.context;return _.set(u,"."+$r,u+"."+ji),_.set(u,"."+Wr,u+"."+Xi),"null"})}else if(wr in h){var d=h[wr];return qe(d,function(l,_){var t=l.invoke(_,d),u=l.shared,o=u.framebuffer,m=_.def(o,".getFramebuffer(",t,")");a.optional(function(){l.assert(_,"!"+t+"||"+m,"invalid framebuffer object")}),_.set(o,".next",m);var b=u.context;return _.set(b,"."+$r,m+"?"+m+".width:"+b+"."+ji),_.set(b,"."+Wr,m+"?"+m+".height:"+b+"."+Xi),m})}else return null}function ue(i,r,c){var h=i.static,p=i.dynamic;function d(t){if(t in h){var u=h[t];a.commandType(u,"object","invalid "+t,c.commandStr);var o=!0,m=u.x|0,b=u.y|0,R,U;return"width"in u?(R=u.width|0,a.command(R>=0,"invalid "+t,c.commandStr)):o=!1,"height"in u?(U=u.height|0,a.command(U>=0,"invalid "+t,c.commandStr)):o=!1,new ze(!o&&r&&r.thisDep,!o&&r&&r.contextDep,!o&&r&&r.propDep,function(z,pe){var V=z.shared.context,ae=R;"width"in u||(ae=pe.def(V,".",$r,"-",m));var re=U;return"height"in u||(re=pe.def(V,".",Wr,"-",b)),[m,b,ae,re]})}else if(t in p){var H=p[t],Q=qe(H,function(z,pe){var V=z.invoke(pe,H);a.optional(function(){z.assert(pe,V+"&&typeof "+V+'==="object"',"invalid "+t)});var ae=z.shared.context,re=pe.def(V,".x|0"),ie=pe.def(V,".y|0"),oe=pe.def('"width" in ',V,"?",V,".width|0:","(",ae,".",$r,"-",re,")"),xe=pe.def('"height" in ',V,"?",V,".height|0:","(",ae,".",Wr,"-",ie,")");return a.optional(function(){z.assert(pe,oe+">=0&&"+xe+">=0","invalid "+t)}),[re,ie,oe,xe]});return r&&(Q.thisDep=Q.thisDep||r.thisDep,Q.contextDep=Q.contextDep||r.contextDep,Q.propDep=Q.propDep||r.propDep),Q}else return r?new ze(r.thisDep,r.contextDep,r.propDep,function(z,pe){var V=z.shared.context;return[0,0,pe.def(V,".",$r),pe.def(V,".",Wr)]}):null}var l=d(cr);if(l){var _=l;l=new ze(l.thisDep,l.contextDep,l.propDep,function(t,u){var o=_.append(t,u),m=t.shared.context;return u.set(m,"."+Nu,o[2]),u.set(m,"."+Bu,o[3]),o})}return{viewport:l,scissor_box:d(Nt)}}function de(i,r){var c=i.static,h=typeof c[ft]=="string"&&typeof c[it]=="string";if(h){if(Object.keys(r.dynamic).length>0)return null;var p=r.static,d=Object.keys(p);if(d.length>0&&typeof p[d[0]]=="number"){for(var l=[],_=0;_<d.length;++_)a(typeof p[d[_]]=="number","must specify all vertex attribute locations when using vaos"),l.push([p[d[_]]|0,d[_]]);return l}}return null}function be(i,r,c){var h=i.static,p=i.dynamic;function d(o){if(o in h){var m=n.id(h[o]);a.optional(function(){M.shader(Ji[o],m,a.guessCommand())});var b=Ge(function(){return m});return b.id=m,b}else if(o in p){var R=p[o];return qe(R,function(U,H){var Q=U.invoke(H,R),z=H.def(U.shared.strings,".id(",Q,")");return a.optional(function(){H(U.shared.shader,".shader(",Ji[o],",",z,",",U.command,");")}),z})}return null}var l=d(ft),_=d(it),t=null,u;return pr(l)&&pr(_)?(t=M.program(_.id,l.id,null,c),u=Ge(function(o,m){return o.link(t)})):u=new ze(l&&l.thisDep||_&&_.thisDep,l&&l.contextDep||_&&_.contextDep,l&&l.propDep||_&&_.propDep,function(o,m){var b=o.shared.shader,R;l?R=l.append(o,m):R=m.def(b,".",ft);var U;_?U=_.append(o,m):U=m.def(b,".",it);var H=b+".program("+U+","+R;return a.optional(function(){H+=","+o.command}),m.def(H+")")}),{frag:l,vert:_,progVar:u,program:t}}function Le(i,r){var c=i.static,h=i.dynamic,p={},d=!1,l=!1;function _(){if(ot in c){a(!c.elements&&!h.elements,"cannot specify elements with vao");var V=c[ot];return V!==null&&B.getVAO(V)===null&&(V=B.createVAO(V)),d=!0,l=!!V,p.vao=V,Ge(function(re){var ie=B.getVAO(V);return ie?re.link(ie):"null"})}else if(ot in h){a(!c.elements&&!h.elements,"cannot specify elements with vao"),d=!0,l=!0;var ae=h[ot];return qe(ae,function(re,ie){var oe=re.invoke(ie,ae);return ie.def(re.shared.vao+".getVAO("+oe+")")})}return null}var t=_(),u=!1;function o(){if(Lr in c){a(!l,"must not specify vao and elements");var V=c[Lr];if(p.elements=V,Wt(V)){var ae=p.elements=E.create(V,!0);V=E.getElements(ae),u=!0}else V&&(V=E.getElements(V),u=!0,a.command(V,"invalid elements",r.commandStr));var re=Ge(function(oe,xe){if(V){var Oe=oe.link(V);return oe.ELEMENTS=Oe,Oe}return oe.ELEMENTS=null,null});return re.value=V,re}else if(Lr in h){a(!l,"must not specify vao and elements"),u=!0;var ie=h[Lr];return qe(ie,function(oe,xe){var Oe=oe.shared,Ue=Oe.isBufferArgs,_r=Oe.elements,Dr=oe.invoke(xe,ie),He=xe.def("null"),or=xe.def(Ue,"(",Dr,")"),Ye=oe.cond(or).then(He,"=",_r,".createStream(",Dr,");").else(He,"=",_r,".getElements(",Dr,");");return a.optional(function(){oe.assert(Ye.else,"!"+Dr+"||"+He,"invalid elements")}),xe.entry(Ye),xe.exit(oe.cond(or).then(_r,".destroyStream(",He,");")),oe.ELEMENTS=He,He})}else if(d)return new ze(t.thisDep,t.contextDep,t.propDep,function(oe,xe){return xe.def(oe.shared.vao+".currentVAO?"+oe.shared.elements+".getElements("+oe.shared.vao+".currentVAO.elements):null")});return null}var m=o();u&&(t=Ge(function(){return"null"}));function b(){if(Or in c){var V=c[Or];return p.primitive=V,a.commandParameter(V,dr,"invalid primitve",r.commandStr),Ge(function(re,ie){return dr[V]})}else if(Or in h){var ae=h[Or];return qe(ae,function(re,ie){var oe=re.constants.primTypes,xe=re.invoke(ie,ae);return a.optional(function(){re.assert(ie,xe+" in "+oe,"invalid primitive, must be one of "+Object.keys(dr))}),ie.def(oe,"[",xe,"]")})}else{if(u)return pr(m)?m.value?Ge(function(re,ie){return ie.def(re.ELEMENTS,".primType")}):Ge(function(){return Wn}):new ze(m.thisDep,m.contextDep,m.propDep,function(re,ie){var oe=re.ELEMENTS;return ie.def(oe,"?",oe,".primType:",Wn)});if(d)return new ze(t.thisDep,t.contextDep,t.propDep,function(re,ie){return ie.def(re.shared.vao+".currentVAO?"+re.shared.vao+".currentVAO.primitive:"+Wn)})}return null}function R(V,ae){if(V in c){var re=c[V]|0;return ae?p.offset=re:p.instances=re,a.command(!ae||re>=0,"invalid "+V,r.commandStr),Ge(function(oe,xe){return ae&&(oe.OFFSET=re),re})}else if(V in h){var ie=h[V];return qe(ie,function(oe,xe){var Oe=oe.invoke(xe,ie);return ae&&(oe.OFFSET=Oe,a.optional(function(){oe.assert(xe,Oe+">=0","invalid "+V)})),Oe})}else if(ae){if(u)return Ge(function(oe,xe){return oe.OFFSET=0,0});if(d)return new ze(t.thisDep,t.contextDep,t.propDep,function(oe,xe){return xe.def(oe.shared.vao+".currentVAO?"+oe.shared.vao+".currentVAO.offset:0")})}else if(d)return new ze(t.thisDep,t.contextDep,t.propDep,function(oe,xe){return xe.def(oe.shared.vao+".currentVAO?"+oe.shared.vao+".currentVAO.instances:-1")});return null}var U=R(Bt,!0);function H(){if(Rr in c){var V=c[Rr]|0;return p.count=V,a.command(typeof V=="number"&&V>=0,"invalid vertex count",r.commandStr),Ge(function(){return V})}else if(Rr in h){var ae=h[Rr];return qe(ae,function(xe,Oe){var Ue=xe.invoke(Oe,ae);return a.optional(function(){xe.assert(Oe,"typeof "+Ue+'==="number"&&'+Ue+">=0&&"+Ue+"===("+Ue+"|0)","invalid vertex count")}),Ue})}else if(u)if(pr(m)){if(m)return U?new ze(U.thisDep,U.contextDep,U.propDep,function(xe,Oe){var Ue=Oe.def(xe.ELEMENTS,".vertCount-",xe.OFFSET);return a.optional(function(){xe.assert(Oe,Ue+">=0","invalid vertex offset/element buffer too small")}),Ue}):Ge(function(xe,Oe){return Oe.def(xe.ELEMENTS,".vertCount")});var re=Ge(function(){return-1});return a.optional(function(){re.MISSING=!0}),re}else{var ie=new ze(m.thisDep||U.thisDep,m.contextDep||U.contextDep,m.propDep||U.propDep,function(xe,Oe){var Ue=xe.ELEMENTS;return xe.OFFSET?Oe.def(Ue,"?",Ue,".vertCount-",xe.OFFSET,":-1"):Oe.def(Ue,"?",Ue,".vertCount:-1")});return a.optional(function(){ie.DYNAMIC=!0}),ie}else if(d){var oe=new ze(t.thisDep,t.contextDep,t.propDep,function(xe,Oe){return Oe.def(xe.shared.vao,".currentVAO?",xe.shared.vao,".currentVAO.count:-1")});return oe}return null}var Q=b(),z=H(),pe=R(It,!1);return{elements:m,primitive:Q,count:z,instances:pe,offset:U,vao:t,vaoActive:d,elementsActive:u,static:p}}function Re(i,r){var c=i.static,h=i.dynamic,p={};return fe.forEach(function(d){var l=ne(d);function _(t,u){if(d in c){var o=t(c[d]);p[l]=Ge(function(){return o})}else if(d in h){var m=h[d];p[l]=qe(m,function(b,R){return u(b,R,b.invoke(R,m))})}}switch(d){case Ni:case Ri:case Oi:case Ui:case Gi:case zi:case Ii:case ki:case Mi:case Pi:return _(function(t){return a.commandType(t,"boolean",d,r.commandStr),t},function(t,u,o){return a.optional(function(){t.assert(u,"typeof "+o+'==="boolean"',"invalid flag "+d,t.commandStr)}),o});case Di:return _(function(t){return a.commandParameter(t,qr,"invalid "+d,r.commandStr),qr[t]},function(t,u,o){var m=t.constants.compareFuncs;return a.optional(function(){t.assert(u,o+" in "+m,"invalid "+d+", must be one of "+Object.keys(qr))}),u.def(m,"[",o,"]")});case Fi:return _(function(t){return a.command(Ce(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"&&t[0]<=t[1],"depth range is 2d array",r.commandStr),t},function(t,u,o){a.optional(function(){t.assert(u,t.shared.isArrayLike+"("+o+")&&"+o+".length===2&&typeof "+o+'[0]==="number"&&typeof '+o+'[1]==="number"&&'+o+"[0]<="+o+"[1]","depth range must be a 2d array")});var m=u.def("+",o,"[0]"),b=u.def("+",o,"[1]");return[m,b]});case Fn:return _(function(t){a.commandType(t,"object","blend.func",r.commandStr);var u="srcRGB"in t?t.srcRGB:t.src,o="srcAlpha"in t?t.srcAlpha:t.src,m="dstRGB"in t?t.dstRGB:t.dst,b="dstAlpha"in t?t.dstAlpha:t.dst;return a.commandParameter(u,ir,l+".srcRGB",r.commandStr),a.commandParameter(o,ir,l+".srcAlpha",r.commandStr),a.commandParameter(m,ir,l+".dstRGB",r.commandStr),a.commandParameter(b,ir,l+".dstAlpha",r.commandStr),a.command(Zi.indexOf(u+", "+m)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+u+", "+m+")",r.commandStr),[ir[u],ir[m],ir[o],ir[b]]},function(t,u,o){var m=t.constants.blendFuncs;a.optional(function(){t.assert(u,o+"&&typeof "+o+'==="object"',"invalid blend func, must be an object")});function b(V,ae){var re=u.def('"',V,ae,'" in ',o,"?",o,".",V,ae,":",o,".",V);return a.optional(function(){t.assert(u,re+" in "+m,"invalid "+d+"."+V+ae+", must be one of "+Object.keys(ir))}),re}var R=b("src","RGB"),U=b("dst","RGB");a.optional(function(){var V=t.constants.invalidBlendCombinations;t.assert(u,V+".indexOf("+R+'+", "+'+U+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var H=u.def(m,"[",R,"]"),Q=u.def(m,"[",b("src","Alpha"),"]"),z=u.def(m,"[",U,"]"),pe=u.def(m,"[",b("dst","Alpha"),"]");return[H,z,Q,pe]});case Dn:return _(function(t){if(typeof t=="string")return a.commandParameter(t,T,"invalid "+d,r.commandStr),[T[t],T[t]];if(typeof t=="object")return a.commandParameter(t.rgb,T,d+".rgb",r.commandStr),a.commandParameter(t.alpha,T,d+".alpha",r.commandStr),[T[t.rgb],T[t.alpha]];a.commandRaise("invalid blend.equation",r.commandStr)},function(t,u,o){var m=t.constants.blendEquations,b=u.def(),R=u.def(),U=t.cond("typeof ",o,'==="string"');return a.optional(function(){function H(Q,z,pe){t.assert(Q,pe+" in "+m,"invalid "+z+", must be one of "+Object.keys(T))}H(U.then,d,o),t.assert(U.else,o+"&&typeof "+o+'==="object"',"invalid "+d),H(U.else,d+".rgb",o+".rgb"),H(U.else,d+".alpha",o+".alpha")}),U.then(b,"=",R,"=",m,"[",o,"];"),U.else(b,"=",m,"[",o,".rgb];",R,"=",m,"[",o,".alpha];"),u(U),[b,R]});case Ci:return _(function(t){return a.command(Ce(t)&&t.length===4,"blend.color must be a 4d array",r.commandStr),Ze(4,function(u){return+t[u]})},function(t,u,o){return a.optional(function(){t.assert(u,t.shared.isArrayLike+"("+o+")&&"+o+".length===4","blend.color must be a 4d array")}),Ze(4,function(m){return u.def("+",o,"[",m,"]")})});case Vi:return _(function(t){return a.commandType(t,"number",l,r.commandStr),t|0},function(t,u,o){return a.optional(function(){t.assert(u,"typeof "+o+'==="number"',"invalid stencil.mask")}),u.def(o,"|0")});case Mn:return _(function(t){a.commandType(t,"object",l,r.commandStr);var u=t.cmp||"keep",o=t.ref||0,m="mask"in t?t.mask:-1;return a.commandParameter(u,qr,d+".cmp",r.commandStr),a.commandType(o,"number",d+".ref",r.commandStr),a.commandType(m,"number",d+".mask",r.commandStr),[qr[u],o,m]},function(t,u,o){var m=t.constants.compareFuncs;a.optional(function(){function H(){t.assert(u,Array.prototype.join.call(arguments,""),"invalid stencil.func")}H(o+"&&typeof ",o,'==="object"'),H('!("cmp" in ',o,")||(",o,".cmp in ",m,")")});var b=u.def('"cmp" in ',o,"?",m,"[",o,".cmp]",":",hr),R=u.def(o,".ref|0"),U=u.def('"mask" in ',o,"?",o,".mask|0:-1");return[b,R,U]});case Un:case nt:return _(function(t){a.commandType(t,"object",l,r.commandStr);var u=t.fail||"keep",o=t.zfail||"keep",m=t.zpass||"keep";return a.commandParameter(u,vr,d+".fail",r.commandStr),a.commandParameter(o,vr,d+".zfail",r.commandStr),a.commandParameter(m,vr,d+".zpass",r.commandStr),[d===nt?Cr:mt,vr[u],vr[o],vr[m]]},function(t,u,o){var m=t.constants.stencilOps;a.optional(function(){t.assert(u,o+"&&typeof "+o+'==="object"',"invalid "+d)});function b(R){return a.optional(function(){t.assert(u,'!("'+R+'" in '+o+")||("+o+"."+R+" in "+m+")","invalid "+d+"."+R+", must be one of "+Object.keys(vr))}),u.def('"',R,'" in ',o,"?",m,"[",o,".",R,"]:",hr)}return[d===nt?Cr:mt,b("fail"),b("zfail"),b("zpass")]});case In:return _(function(t){a.commandType(t,"object",l,r.commandStr);var u=t.factor|0,o=t.units|0;return a.commandType(u,"number",l+".factor",r.commandStr),a.commandType(o,"number",l+".units",r.commandStr),[u,o]},function(t,u,o){a.optional(function(){t.assert(u,o+"&&typeof "+o+'==="object"',"invalid "+d)});var m=u.def(o,".factor|0"),b=u.def(o,".units|0");return[m,b]});case Bi:return _(function(t){var u=0;return t==="front"?u=mt:t==="back"&&(u=Cr),a.command(!!u,l,r.commandStr),u},function(t,u,o){return a.optional(function(){t.assert(u,o+'==="front"||'+o+'==="back"',"invalid cull.face")}),u.def(o,'==="front"?',mt,":",Cr)});case Bn:return _(function(t){return a.command(typeof t=="number"&&t>=x.lineWidthDims[0]&&t<=x.lineWidthDims[1],"invalid line width, must be a positive number between "+x.lineWidthDims[0]+" and "+x.lineWidthDims[1],r.commandStr),t},function(t,u,o){return a.optional(function(){t.assert(u,"typeof "+o+'==="number"&&'+o+">="+x.lineWidthDims[0]+"&&"+o+"<="+x.lineWidthDims[1],"invalid line width")}),o});case Nn:return _(function(t){return a.commandParameter(t,qn,l,r.commandStr),qn[t]},function(t,u,o){return a.optional(function(){t.assert(u,o+'==="cw"||'+o+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),u.def(o+'==="cw"?'+Wi+":"+Yn)});case Pn:return _(function(t){return a.command(Ce(t)&&t.length===4,"color.mask must be length 4 array",r.commandStr),t.map(function(u){return!!u})},function(t,u,o){return a.optional(function(){t.assert(u,t.shared.isArrayLike+"("+o+")&&"+o+".length===4","invalid color.mask")}),Ze(4,function(m){return"!!"+o+"["+m+"]"})});case kn:return _(function(t){a.command(typeof t=="object"&&t,l,r.commandStr);var u="value"in t?t.value:1,o=!!t.invert;return a.command(typeof u=="number"&&u>=0&&u<=1,"sample.coverage.value must be a number between 0 and 1",r.commandStr),[u,o]},function(t,u,o){a.optional(function(){t.assert(u,o+"&&typeof "+o+'==="object"',"invalid sample.coverage")});var m=u.def('"value" in ',o,"?+",o,".value:1"),b=u.def("!!",o,".invert");return[m,b]})}}),p}function Ee(i,r){var c=i.static,h=i.dynamic,p={};return Object.keys(c).forEach(function(d){var l=c[d],_;if(typeof l=="number"||typeof l=="boolean")_=Ge(function(){return l});else if(typeof l=="function"){var t=l._reglType;t==="texture2d"||t==="textureCube"?_=Ge(function(u){return u.link(l)}):t==="framebuffer"||t==="framebufferCube"?(a.command(l.color.length>0,'missing color attachment for framebuffer sent to uniform "'+d+'"',r.commandStr),_=Ge(function(u){return u.link(l.color[0])})):a.commandRaise('invalid data for uniform "'+d+'"',r.commandStr)}else Ce(l)?_=Ge(function(u){var o=u.global.def("[",Ze(l.length,function(m){return a.command(typeof l[m]=="number"||typeof l[m]=="boolean","invalid uniform "+d,u.commandStr),l[m]}),"]");return o}):a.commandRaise('invalid or missing data for uniform "'+d+'"',r.commandStr);_.value=l,p[d]=_}),Object.keys(h).forEach(function(d){var l=h[d];p[d]=qe(l,function(_,t){return _.invoke(t,l)})}),p}function Ie(i,r){var c=i.static,h=i.dynamic,p={};return Object.keys(c).forEach(function(d){var l=c[d],_=n.id(d),t=new v;if(Wt(l))t.state=Xr,t.buffer=w.getBuffer(w.create(l,Yr,!1,!0)),t.type=0;else{var u=w.getBuffer(l);if(u)t.state=Xr,t.buffer=u,t.type=0;else if(a.command(typeof l=="object"&&l,"invalid data for attribute "+d,r.commandStr),"constant"in l){var o=l.constant;t.buffer="null",t.state=Ln,typeof o=="number"?t.x=o:(a.command(Ce(o)&&o.length>0&&o.length<=4,"invalid constant for attribute "+d,r.commandStr),jr.forEach(function(z,pe){pe<o.length&&(t[z]=o[pe])}))}else{Wt(l.buffer)?u=w.getBuffer(w.create(l.buffer,Yr,!1,!0)):u=w.getBuffer(l.buffer),a.command(!!u,'missing buffer for attribute "'+d+'"',r.commandStr);var m=l.offset|0;a.command(m>=0,'invalid offset for attribute "'+d+'"',r.commandStr);var b=l.stride|0;a.command(b>=0&&b<256,'invalid stride for attribute "'+d+'", must be integer betweeen [0, 255]',r.commandStr);var R=l.size|0;a.command(!("size"in l)||R>0&&R<=4,'invalid size for attribute "'+d+'", must be 1,2,3,4',r.commandStr);var U=!!l.normalized,H=0;"type"in l&&(a.commandParameter(l.type,xr,"invalid type for attribute "+d,r.commandStr),H=xr[l.type]);var Q=l.divisor|0;a.optional(function(){"divisor"in l&&(a.command(Q===0||P,'cannot specify divisor for attribute "'+d+'", instancing not supported',r.commandStr),a.command(Q>=0,'invalid divisor for attribute "'+d+'"',r.commandStr));var z=r.commandStr,pe=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(l).forEach(function(V){a.command(pe.indexOf(V)>=0,'unknown parameter "'+V+'" for attribute pointer "'+d+'" (valid parameters are '+pe+")",z)})}),t.buffer=u,t.state=Xr,t.size=R,t.normalized=U,t.type=H||u.dtype,t.offset=m,t.stride=b,t.divisor=Q}}p[d]=Ge(function(z,pe){var V=z.attribCache;if(_ in V)return V[_];var ae={isStream:!1};return Object.keys(t).forEach(function(re){ae[re]=t[re]}),t.buffer&&(ae.buffer=z.link(t.buffer),ae.type=ae.type||ae.buffer+".dtype"),V[_]=ae,ae})}),Object.keys(h).forEach(function(d){var l=h[d];function _(t,u){var o=t.invoke(u,l),m=t.shared,b=t.constants,R=m.isBufferArgs,U=m.buffer;a.optional(function(){t.assert(u,o+"&&(typeof "+o+'==="object"||typeof '+o+'==="function")&&('+R+"("+o+")||"+U+".getBuffer("+o+")||"+U+".getBuffer("+o+".buffer)||"+R+"("+o+'.buffer)||("constant" in '+o+"&&(typeof "+o+'.constant==="number"||'+m.isArrayLike+"("+o+".constant))))",'invalid dynamic attribute "'+d+'"')});var H={isStream:u.def(!1)},Q=new v;Q.state=Xr,Object.keys(Q).forEach(function(ae){H[ae]=u.def(""+Q[ae])});var z=H.buffer,pe=H.type;u("if(",R,"(",o,")){",H.isStream,"=true;",z,"=",U,".createStream(",Yr,",",o,");",pe,"=",z,".dtype;","}else{",z,"=",U,".getBuffer(",o,");","if(",z,"){",pe,"=",z,".dtype;",'}else if("constant" in ',o,"){",H.state,"=",Ln,";","if(typeof "+o+'.constant === "number"){',H[jr[0]],"=",o,".constant;",jr.slice(1).map(function(ae){return H[ae]}).join("="),"=0;","}else{",jr.map(function(ae,re){return H[ae]+"="+o+".constant.length>"+re+"?"+o+".constant["+re+"]:0;"}).join(""),"}}else{","if(",R,"(",o,".buffer)){",z,"=",U,".createStream(",Yr,",",o,".buffer);","}else{",z,"=",U,".getBuffer(",o,".buffer);","}",pe,'="type" in ',o,"?",b.glTypes,"[",o,".type]:",z,".dtype;",H.normalized,"=!!",o,".normalized;");function V(ae){u(H[ae],"=",o,".",ae,"|0;")}return V("size"),V("offset"),V("stride"),V("divisor"),u("}}"),u.exit("if(",H.isStream,"){",U,".destroyStream(",z,");","}"),H}p[d]=qe(l,_)}),p}function we(i){var r=i.static,c=i.dynamic,h={};return Object.keys(r).forEach(function(p){var d=r[p];h[p]=Ge(function(l,_){return typeof d=="number"||typeof d=="boolean"?""+d:l.link(d)})}),Object.keys(c).forEach(function(p){var d=c[p];h[p]=qe(d,function(l,_){return l.invoke(_,d)})}),h}function Be(i,r,c,h,p){var d=i.static,l=i.dynamic;a.optional(function(){var V=[wr,it,ft,Lr,Or,Bt,Rr,It,at,ot].concat(fe);function ae(re){Object.keys(re).forEach(function(ie){a.command(V.indexOf(ie)>=0,'unknown parameter "'+ie+'"',p.commandStr)})}ae(d),ae(l)});var _=de(i,r),t=J(i),u=ue(i,t,p),o=Le(i,p),m=Re(i,p),b=be(i,p,_);function R(V){var ae=u[V];ae&&(m[V]=ae)}R(cr),R(ne(Nt));var U=Object.keys(m).length>0,H={framebuffer:t,draw:o,shader:b,state:m,dirty:U,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(H.profile=q(i),H.uniforms=Ee(c,p),H.drawVAO=H.scopeVAO=o.vao,!H.drawVAO&&b.program&&!_&&s.angle_instanced_arrays&&o.static.elements){var Q=!0,z=b.program.attributes.map(function(V){var ae=r.static[V];return Q=Q&&!!ae,ae});if(Q&&z.length>0){var pe=B.getVAO(B.createVAO({attributes:z,elements:o.static.elements}));H.drawVAO=new ze(null,null,null,function(V,ae){return V.link(pe)}),H.useVAO=!0}}return _?(a(!o.elementsActive,"can not combine elements and vertex array objects. element binding state must be specified in vertex array object"),H.useVAO=!0):H.attributes=Ie(r,p),H.context=we(h),H}function ke(i,r,c){var h=i.shared,p=h.context,d=i.scope();Object.keys(c).forEach(function(l){r.save(p,"."+l);var _=c[l],t=_.append(i,r);Array.isArray(t)?d(p,".",l,"=[",t.join(),"];"):d(p,".",l,"=",t,";")}),r(d)}function Me(i,r,c,h){var p=i.shared,d=p.gl,l=p.framebuffer,_;ee&&(_=r.def(p.extensions,".webgl_draw_buffers"));var t=i.constants,u=t.drawBuffer,o=t.backBuffer,m;c?m=c.append(i,r):m=r.def(l,".next"),h||r("if(",m,"!==",l,".cur){"),r("if(",m,"){",d,".bindFramebuffer(",Ki,",",m,".framebuffer);"),ee&&r(_,".drawBuffersWEBGL(",u,"[",m,".colorAttachments.length]);"),r("}else{",d,".bindFramebuffer(",Ki,",null);"),ee&&r(_,".drawBuffersWEBGL(",o,");"),r("}",l,".cur=",m,";"),h||r("}")}function je(i,r,c){var h=i.shared,p=h.gl,d=i.current,l=i.next,_=h.current,t=h.next,u=i.cond(_,".dirty");fe.forEach(function(o){var m=ne(o);if(!(m in c.state)){var b,R;if(m in l){b=l[m],R=d[m];var U=Ze(Z[m].length,function(Q){return u.def(b,"[",Q,"]")});u(i.cond(U.map(function(Q,z){return Q+"!=="+R+"["+z+"]"}).join("||")).then(p,".",g[m],"(",U,");",U.map(function(Q,z){return R+"["+z+"]="+Q}).join(";"),";"))}else{b=u.def(t,".",m);var H=i.cond(b,"!==",_,".",m);u(H),m in L?H(i.cond(b).then(p,".enable(",L[m],");").else(p,".disable(",L[m],");"),_,".",m,"=",b,";"):H(p,".",g[m],"(",b,");",_,".",m,"=",b,";")}}}),Object.keys(c.state).length===0&&u(_,".dirty=false;"),r(u)}function $e(i,r,c,h){var p=i.shared,d=i.current,l=p.current,_=p.gl;ef(Object.keys(c)).forEach(function(t){var u=c[t];if(!(h&&!h(u))){var o=u.append(i,r);if(L[t]){var m=L[t];pr(u)?o?r(_,".enable(",m,");"):r(_,".disable(",m,");"):r(i.cond(o).then(_,".enable(",m,");").else(_,".disable(",m,");")),r(l,".",t,"=",o,";")}else if(Ce(o)){var b=d[t];r(_,".",g[t],"(",o,");",o.map(function(R,U){return b+"["+U+"]="+R}).join(";"),";")}else r(_,".",g[t],"(",o,");",l,".",t,"=",o,";")}})}function De(i,r){P&&(i.instancing=r.def(i.shared.extensions,".angle_instanced_arrays"))}function ve(i,r,c,h,p){var d=i.shared,l=i.stats,_=d.current,t=d.timer,u=c.profile;function o(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var m,b;function R(V){m=r.def(),V(m,"=",o(),";"),typeof p=="string"?V(l,".count+=",p,";"):V(l,".count++;"),D&&(h?(b=r.def(),V(b,"=",t,".getNumPendingQueries();")):V(t,".beginQuery(",l,");"))}function U(V){V(l,".cpuTime+=",o(),"-",m,";"),D&&(h?V(t,".pushScopeStats(",b,",",t,".getNumPendingQueries(),",l,");"):V(t,".endQuery();"))}function H(V){var ae=r.def(_,".profile");r(_,".profile=",V,";"),r.exit(_,".profile=",ae,";")}var Q;if(u){if(pr(u)){u.enable?(R(r),U(r.exit),H("true")):H("false");return}Q=u.append(i,r),H(Q)}else Q=r.def(_,".profile");var z=i.block();R(z),r("if(",Q,"){",z,"}");var pe=i.block();U(pe),r.exit("if(",Q,"){",pe,"}")}function We(i,r,c,h,p){var d=i.shared;function l(t){switch(t){case kt:case Vt:case jt:return 2;case Mt:case zt:case Xt:return 3;case Ut:case Ht:case $t:return 4;default:return 1}}function _(t,u,o){var m=d.gl,b=r.def(t,".location"),R=r.def(d.attributes,"[",b,"]"),U=o.state,H=o.buffer,Q=[o.x,o.y,o.z,o.w],z=["buffer","normalized","offset","stride"];function pe(){r("if(!",R,".buffer){",m,".enableVertexAttribArray(",b,");}");var ae=o.type,re;if(o.size?re=r.def(o.size,"||",u):re=u,r("if(",R,".type!==",ae,"||",R,".size!==",re,"||",z.map(function(oe){return R+"."+oe+"!=="+o[oe]}).join("||"),"){",m,".bindBuffer(",Yr,",",H,".buffer);",m,".vertexAttribPointer(",[b,re,ae,o.normalized,o.stride,o.offset],");",R,".type=",ae,";",R,".size=",re,";",z.map(function(oe){return R+"."+oe+"="+o[oe]+";"}).join(""),"}"),P){var ie=o.divisor;r("if(",R,".divisor!==",ie,"){",i.instancing,".vertexAttribDivisorANGLE(",[b,ie],");",R,".divisor=",ie,";}")}}function V(){r("if(",R,".buffer){",m,".disableVertexAttribArray(",b,");",R,".buffer=null;","}if(",jr.map(function(ae,re){return R+"."+ae+"!=="+Q[re]}).join("||"),"){",m,".vertexAttrib4f(",b,",",Q,");",jr.map(function(ae,re){return R+"."+ae+"="+Q[re]+";"}).join(""),"}")}U===Xr?pe():U===Ln?V():(r("if(",U,"===",Xr,"){"),pe(),r("}else{"),V(),r("}"))}h.forEach(function(t){var u=t.name,o=c.attributes[u],m;if(o){if(!p(o))return;m=o.append(i,r)}else{if(!p(rf))return;var b=i.scopeAttrib(u);a.optional(function(){i.assert(r,b+".state","missing attribute "+u)}),m={},Object.keys(new v).forEach(function(R){m[R]=r.def(b,".",R)})}_(i.link(t),l(t.info.type),m)})}function Te(i,r,c,h,p,d){for(var l=i.shared,_=l.gl,t,u=0;u<h.length;++u){var o=h[u],m=o.name,b=o.info.type,R=c.uniforms[m],U=i.link(o),H=U+".location",Q;if(R){if(!p(R))continue;if(pr(R)){var z=R.value;if(a.command(z!==null&&typeof z!="undefined",'missing uniform "'+m+'"',i.commandStr),b===lt||b===dt){a.command(typeof z=="function"&&(b===lt&&(z._reglType==="texture2d"||z._reglType==="framebuffer")||b===dt&&(z._reglType==="textureCube"||z._reglType==="framebufferCube")),"invalid texture for uniform "+m,i.commandStr);var pe=i.link(z._texture||z.color[0]._texture);r(_,".uniform1i(",H,",",pe+".bind());"),r.exit(pe,".unbind();")}else if(b===st||b===ut||b===ct){a.optional(function(){a.command(Ce(z),"invalid matrix for uniform "+m,i.commandStr),a.command(b===st&&z.length===4||b===ut&&z.length===9||b===ct&&z.length===16,"invalid length for matrix uniform "+m,i.commandStr)});var V=i.global.def("new Float32Array(["+Array.prototype.slice.call(z)+"])"),ae=2;b===ut?ae=3:b===ct&&(ae=4),r(_,".uniformMatrix",ae,"fv(",H,",false,",V,");")}else{switch(b){case jn:a.commandType(z,"number","uniform "+m,i.commandStr),t="1f";break;case kt:a.command(Ce(z)&&z.length===2,"uniform "+m,i.commandStr),t="2f";break;case Mt:a.command(Ce(z)&&z.length===3,"uniform "+m,i.commandStr),t="3f";break;case Ut:a.command(Ce(z)&&z.length===4,"uniform "+m,i.commandStr),t="4f";break;case $n:a.commandType(z,"boolean","uniform "+m,i.commandStr),t="1i";break;case Xn:a.commandType(z,"number","uniform "+m,i.commandStr),t="1i";break;case jt:a.command(Ce(z)&&z.length===2,"uniform "+m,i.commandStr),t="2i";break;case Vt:a.command(Ce(z)&&z.length===2,"uniform "+m,i.commandStr),t="2i";break;case Xt:a.command(Ce(z)&&z.length===3,"uniform "+m,i.commandStr),t="3i";break;case zt:a.command(Ce(z)&&z.length===3,"uniform "+m,i.commandStr),t="3i";break;case $t:a.command(Ce(z)&&z.length===4,"uniform "+m,i.commandStr),t="4i";break;case Ht:a.command(Ce(z)&&z.length===4,"uniform "+m,i.commandStr),t="4i";break}r(_,".uniform",t,"(",H,",",Ce(z)?Array.prototype.slice.call(z):z,");")}continue}else Q=R.append(i,r)}else{if(!p(rf))continue;Q=r.def(l.uniforms,"[",n.id(m),"]")}b===lt?(a(!Array.isArray(Q),"must specify a scalar prop for textures"),r("if(",Q,"&&",Q,'._reglType==="framebuffer"){',Q,"=",Q,".color[0];","}")):b===dt&&(a(!Array.isArray(Q),"must specify a scalar prop for cube maps"),r("if(",Q,"&&",Q,'._reglType==="framebufferCube"){',Q,"=",Q,".color[0];","}")),a.optional(function(){function He(nr,uf){i.assert(r,nr,'bad data or missing for uniform "'+m+'".  '+uf)}function or(nr){a(!Array.isArray(Q),"must not specify an array type for uniform"),He("typeof "+Q+'==="'+nr+'"',"invalid type, expected "+nr)}function Ye(nr,uf){Array.isArray(Q)?a(Q.length===nr,"must have length "+nr):He(l.isArrayLike+"("+Q+")&&"+Q+".length==="+nr,"invalid vector, should have length "+nr,i.commandStr)}function sf(nr){a(!Array.isArray(Q),"must not specify a value type"),He("typeof "+Q+'==="function"&&'+Q+'._reglType==="texture'+(nr===$i?"2d":"Cube")+'"',"invalid texture type",i.commandStr)}switch(b){case Xn:or("number");break;case Vt:Ye(2);break;case zt:Ye(3);break;case Ht:Ye(4);break;case jn:or("number");break;case kt:Ye(2);break;case Mt:Ye(3);break;case Ut:Ye(4);break;case $n:or("boolean");break;case jt:Ye(2);break;case Xt:Ye(3);break;case $t:Ye(4);break;case st:Ye(4);break;case ut:Ye(9);break;case ct:Ye(16);break;case lt:sf($i);break;case dt:sf(Uu);break}});var re=1;switch(b){case lt:case dt:var ie=r.def(Q,"._texture");r(_,".uniform1i(",H,",",ie,".bind());"),r.exit(ie,".unbind();");continue;case Xn:case $n:t="1i";break;case Vt:case jt:t="2i",re=2;break;case zt:case Xt:t="3i",re=3;break;case Ht:case $t:t="4i",re=4;break;case jn:t="1f";break;case kt:t="2f",re=2;break;case Mt:t="3f",re=3;break;case Ut:t="4f",re=4;break;case st:t="Matrix2fv";break;case ut:t="Matrix3fv";break;case ct:t="Matrix4fv";break}if(t.charAt(0)==="M"){r(_,".uniform",t,"(",H,",");var oe=Math.pow(b-st+2,2),xe=i.global.def("new Float32Array(",oe,")");Array.isArray(Q)?r("false,(",Ze(oe,function(He){return xe+"["+He+"]="+Q[He]}),",",xe,")"):r("false,(Array.isArray(",Q,")||",Q," instanceof Float32Array)?",Q,":(",Ze(oe,function(He){return xe+"["+He+"]="+Q+"["+He+"]"}),",",xe,")"),r(");")}else if(re>1){for(var Oe=[],Ue=[],_r=0;_r<re;++_r)Array.isArray(Q)?Ue.push(Q[_r]):Ue.push(r.def(Q+"["+_r+"]")),d&&Oe.push(r.def());d&&r("if(!",i.batchId,"||",Oe.map(function(He,or){return He+"!=="+Ue[or]}).join("||"),"){",Oe.map(function(He,or){return He+"="+Ue[or]+";"}).join("")),r(_,".uniform",t,"(",H,",",Ue.join(","),");"),d&&r("}")}else{if(a(!Array.isArray(Q),"uniform value must not be an array"),d){var Dr=r.def();r("if(!",i.batchId,"||",Dr,"!==",Q,"){",Dr,"=",Q,";")}r(_,".uniform",t,"(",H,",",Q,");"),d&&r("}")}}}function se(i,r,c,h){var p=i.shared,d=p.gl,l=p.draw,_=h.draw;function t(){var re=_.elements,ie,oe=r;return re?((re.contextDep&&h.contextDynamic||re.propDep)&&(oe=c),_.vaoActive?ie=re.append(i,oe):(ie=re.append(i,oe),oe("if("+ie+")"+d+".bindBuffer("+Hn+","+ie+".buffer.buffer);"))):(ie=oe.def(),oe("if(",p.vao,".currentVAO){",ie,"=",i.shared.elements+".getElements("+p.vao,".currentVAO.elements);",O?"":"if("+ie+")"+d+".bindBuffer("+Hn+","+ie+".buffer.buffer);","}else{",ie,"=",l,".",Lr,";","if(",ie,"){",d,".bindBuffer(",Hn,",",ie,".buffer.buffer);}}")),ie}function u(){var re=_.count,ie,oe=r;return re?((re.contextDep&&h.contextDynamic||re.propDep)&&(oe=c),ie=re.append(i,oe),a.optional(function(){re.MISSING&&i.assert(r,"false","missing vertex count"),re.DYNAMIC&&i.assert(oe,ie+">=0","missing vertex count")})):(ie=oe.def(l,".",Rr),a.optional(function(){i.assert(oe,ie+">=0","missing vertex count")})),ie}var o=t();function m(re){var ie=_[re];return ie?ie.contextDep&&h.contextDynamic||ie.propDep?ie.append(i,c):ie.append(i,r):r.def(l,".",re)}var b=m(Or),R=m(Bt),U=u();if(typeof U=="number"){if(U===0)return}else c("if(",U,"){"),c.exit("}");var H,Q;P&&(H=m(It),Q=i.instancing);var z=o+".type",pe=_.elements&&pr(_.elements)&&!_.vaoActive;function V(){function re(){c(Q,".drawElementsInstancedANGLE(",[b,U,z,R+"<<(("+z+"-"+gi+")>>1)",H],");")}function ie(){c(Q,".drawArraysInstancedANGLE(",[b,R,U,H],");")}o&&o!=="null"?pe?re():(c("if(",o,"){"),re(),c("}else{"),ie(),c("}")):ie()}function ae(){function re(){c(d+".drawElements("+[b,U,z,R+"<<(("+z+"-"+gi+")>>1)"]+");")}function ie(){c(d+".drawArrays("+[b,R,U]+");")}o&&o!=="null"?pe?re():(c("if(",o,"){"),re(),c("}else{"),ie(),c("}")):ie()}P&&(typeof H!="number"||H>=0)?typeof H=="string"?(c("if(",H,">0){"),V(),c("}else if(",H,"<0){"),ae(),c("}")):V():ae()}function ye(i,r,c,h,p){var d=le(),l=d.proc("body",p);return a.optional(function(){d.commandStr=r.commandStr,d.command=d.link(r.commandStr)}),P&&(d.instancing=l.def(d.shared.extensions,".angle_instanced_arrays")),i(d,l,c,h),d.compile().body}function Ae(i,r,c,h){De(i,r),c.useVAO?c.drawVAO?r(i.shared.vao,".setVAO(",c.drawVAO.append(i,r),");"):r(i.shared.vao,".setVAO(",i.shared.vao,".targetVAO);"):(r(i.shared.vao,".setVAO(null);"),We(i,r,c,h.attributes,function(){return!0})),Te(i,r,c,h.uniforms,function(){return!0},!1),se(i,r,r,c)}function Fe(i,r){var c=i.proc("draw",1);De(i,c),ke(i,c,r.context),Me(i,c,r.framebuffer),je(i,c,r),$e(i,c,r.state),ve(i,c,r,!1,!0);var h=r.shader.progVar.append(i,c);if(c(i.shared.gl,".useProgram(",h,".program);"),r.shader.program)Ae(i,c,r,r.shader.program);else{c(i.shared.vao,".setVAO(null);");var p=i.global.def("{}"),d=c.def(h,".id"),l=c.def(p,"[",d,"]");c(i.cond(l).then(l,".call(this,a0);").else(l,"=",p,"[",d,"]=",i.link(function(_){return ye(Ae,i,r,_,1)}),"(",h,");",l,".call(this,a0);"))}Object.keys(r.state).length>0&&c(i.shared.current,".dirty=true;")}function fr(i,r,c,h){i.batchId="a1",De(i,r);function p(){return!0}We(i,r,c,h.attributes,p),Te(i,r,c,h.uniforms,p,!1),se(i,r,r,c)}function Gr(i,r,c,h){De(i,r);var p=c.contextDep,d=r.def(),l="a0",_="a1",t=r.def();i.shared.props=t,i.batchId=d;var u=i.scope(),o=i.scope();r(u.entry,"for(",d,"=0;",d,"<",_,";++",d,"){",t,"=",l,"[",d,"];",o,"}",u.exit);function m(z){return z.contextDep&&p||z.propDep}function b(z){return!m(z)}if(c.needsContext&&ke(i,o,c.context),c.needsFramebuffer&&Me(i,o,c.framebuffer),$e(i,o,c.state,m),c.profile&&m(c.profile)&&ve(i,o,c,!1,!0),h)c.useVAO?c.drawVAO?m(c.drawVAO)?o(i.shared.vao,".setVAO(",c.drawVAO.append(i,o),");"):u(i.shared.vao,".setVAO(",c.drawVAO.append(i,u),");"):u(i.shared.vao,".setVAO(",i.shared.vao,".targetVAO);"):(u(i.shared.vao,".setVAO(null);"),We(i,u,c,h.attributes,b),We(i,o,c,h.attributes,m)),Te(i,u,c,h.uniforms,b,!1),Te(i,o,c,h.uniforms,m,!0),se(i,u,o,c);else{var R=i.global.def("{}"),U=c.shader.progVar.append(i,o),H=o.def(U,".id"),Q=o.def(R,"[",H,"]");o(i.shared.gl,".useProgram(",U,".program);","if(!",Q,"){",Q,"=",R,"[",H,"]=",i.link(function(z){return ye(fr,i,c,z,2)}),"(",U,");}",Q,".call(this,a0[",d,"],",d,");")}}function f(i,r){var c=i.proc("batch",2);i.batchId="0",De(i,c);var h=!1,p=!0;Object.keys(r.context).forEach(function(R){h=h||r.context[R].propDep}),h||(ke(i,c,r.context),p=!1);var d=r.framebuffer,l=!1;d?(d.propDep?h=l=!0:d.contextDep&&h&&(l=!0),l||Me(i,c,d)):Me(i,c,null),r.state.viewport&&r.state.viewport.propDep&&(h=!0);function _(R){return R.contextDep&&h||R.propDep}je(i,c,r),$e(i,c,r.state,function(R){return!_(R)}),(!r.profile||!_(r.profile))&&ve(i,c,r,!1,"a1"),r.contextDep=h,r.needsContext=p,r.needsFramebuffer=l;var t=r.shader.progVar;if(t.contextDep&&h||t.propDep)Gr(i,c,r,null);else{var u=t.append(i,c);if(c(i.shared.gl,".useProgram(",u,".program);"),r.shader.program)Gr(i,c,r,r.shader.program);else{c(i.shared.vao,".setVAO(null);");var o=i.global.def("{}"),m=c.def(u,".id"),b=c.def(o,"[",m,"]");c(i.cond(b).then(b,".call(this,a0,a1);").else(b,"=",o,"[",m,"]=",i.link(function(R){return ye(Gr,i,r,R,2)}),"(",u,");",b,".call(this,a0,a1);"))}}Object.keys(r.state).length>0&&c(i.shared.current,".dirty=true;")}function A(i,r){var c=i.proc("scope",3);i.batchId="a2";var h=i.shared,p=h.current;ke(i,c,r.context),r.framebuffer&&r.framebuffer.append(i,c),ef(Object.keys(r.state)).forEach(function(l){var _=r.state[l],t=_.append(i,c);Ce(t)?t.forEach(function(u,o){c.set(i.next[l],"["+o+"]",u)}):c.set(h.next,"."+l,t)}),ve(i,c,r,!0,!0),[Lr,Bt,Rr,It,Or].forEach(function(l){var _=r.draw[l];!_||c.set(h.draw,"."+l,""+_.append(i,c))}),Object.keys(r.uniforms).forEach(function(l){var _=r.uniforms[l].append(i,c);Array.isArray(_)&&(_="["+_.join()+"]"),c.set(h.uniforms,"["+n.id(l)+"]",_)}),Object.keys(r.attributes).forEach(function(l){var _=r.attributes[l].append(i,c),t=i.scopeAttrib(l);Object.keys(new v).forEach(function(u){c.set(t,"."+u,_[u])})}),r.scopeVAO&&c.set(h.vao,".targetVAO",r.scopeVAO.append(i,c));function d(l){var _=r.shader[l];_&&c.set(h.shader,"."+l,_.append(i,c))}d(it),d(ft),Object.keys(r.state).length>0&&(c(p,".dirty=true;"),c.exit(p,".dirty=true;")),c("a1(",i.shared.context,",a0,",i.batchId,");")}function y(i){if(!(typeof i!="object"||Ce(i))){for(var r=Object.keys(i),c=0;c<r.length;++c)if(Ke.isDynamic(i[r[c]]))return!0;return!1}}function te(i,r,c){var h=r.static[c];if(!h||!y(h))return;var p=i.global,d=Object.keys(h),l=!1,_=!1,t=!1,u=i.global.def("{}");d.forEach(function(m){var b=h[m];if(Ke.isDynamic(b)){typeof b=="function"&&(b=h[m]=Ke.unbox(b));var R=qe(b,null);l=l||R.thisDep,t=t||R.propDep,_=_||R.contextDep}else{switch(p(u,".",m,"="),typeof b){case"number":p(b);break;case"string":p('"',b,'"');break;case"object":Array.isArray(b)&&p("[",b.join(),"]");break;default:p(i.link(b));break}p(";")}});function o(m,b){d.forEach(function(R){var U=h[R];if(!!Ke.isDynamic(U)){var H=m.invoke(b,U);b(u,".",R,"=",H,";")}})}r.dynamic[c]=new Ke.DynamicVariable(Pt,{thisDep:l,contextDep:_,propDep:t,ref:u,append:o}),delete r.static[c]}function _e(i,r,c,h,p){var d=le();d.stats=d.link(p),Object.keys(r.static).forEach(function(_){te(d,r,_)}),Iu.forEach(function(_){te(d,i,_)});var l=Be(i,r,c,h,d);return Fe(d,l),A(d,l),f(d,l),ce(d.compile(),{destroy:function(){l.shader.program.destroy()}})}return{next:Y,current:Z,procs:function(){var i=le(),r=i.proc("poll"),c=i.proc("refresh"),h=i.block();r(h),c(h);var p=i.shared,d=p.gl,l=p.next,_=p.current;h(_,".dirty=false;"),Me(i,r),Me(i,c,null,!0);var t;P&&(t=i.link(P)),s.oes_vertex_array_object&&c(i.link(s.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var u=0;u<x.maxAttributes;++u){var o=c.def(p.attributes,"[",u,"]"),m=i.cond(o,".buffer");m.then(d,".enableVertexAttribArray(",u,");",d,".bindBuffer(",Yr,",",o,".buffer.buffer);",d,".vertexAttribPointer(",u,",",o,".size,",o,".type,",o,".normalized,",o,".stride,",o,".offset);").else(d,".disableVertexAttribArray(",u,");",d,".vertexAttrib4f(",u,",",o,".x,",o,".y,",o,".z,",o,".w);",o,".buffer=null;"),c(m),P&&c(t,".vertexAttribDivisorANGLE(",u,",",o,".divisor);")}return c(i.shared.vao,".currentVAO=null;",i.shared.vao,".setVAO(",i.shared.vao,".targetVAO);"),Object.keys(L).forEach(function(b){var R=L[b],U=h.def(l,".",b),H=i.block();H("if(",U,"){",d,".enable(",R,")}else{",d,".disable(",R,")}",_,".",b,"=",U,";"),c(H),r("if(",U,"!==",_,".",b,"){",H,"}")}),Object.keys(g).forEach(function(b){var R=g[b],U=Z[b],H,Q,z=i.block();if(z(d,".",R,"("),Ce(U)){var pe=U.length;H=i.global.def(l,".",b),Q=i.global.def(_,".",b),z(Ze(pe,function(V){return H+"["+V+"]"}),");",Ze(pe,function(V){return Q+"["+V+"]="+H+"["+V+"];"}).join("")),r("if(",Ze(pe,function(V){return H+"["+V+"]!=="+Q+"["+V+"]"}).join("||"),"){",z,"}")}else H=h.def(l,".",b),Q=h.def(_,".",b),z(H,");",_,".",b,"=",H,";"),r("if(",H,"!==",Q,"){",z,"}");c(z)}),i.compile()}(),compile:_e}}function tc(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var nc=34918,ac=34919,tf=35007,ic=function(e,n){if(!n.ext_disjoint_timer_query)return null;var s=[];function x(){return s.pop()||n.ext_disjoint_timer_query.createQueryEXT()}function w(P){s.push(P)}var E=[];function S(P){var ee=x();n.ext_disjoint_timer_query.beginQueryEXT(tf,ee),E.push(ee),D(E.length-1,E.length,P)}function G(){n.ext_disjoint_timer_query.endQueryEXT(tf)}function C(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var B=[];function M(){return B.pop()||new C}function I(P){B.push(P)}var j=[];function D(P,ee,O){var Z=M();Z.startQueryIndex=P,Z.endQueryIndex=ee,Z.sum=0,Z.stats=O,j.push(Z)}var N=[],v=[];function T(){var P,ee,O=E.length;if(O!==0){v.length=Math.max(v.length,O+1),N.length=Math.max(N.length,O+1),N[0]=0,v[0]=0;var Z=0;for(P=0,ee=0;ee<E.length;++ee){var Y=E[ee];n.ext_disjoint_timer_query.getQueryObjectEXT(Y,ac)?(Z+=n.ext_disjoint_timer_query.getQueryObjectEXT(Y,nc),w(Y)):E[P++]=Y,N[ee+1]=Z,v[ee+1]=P}for(E.length=P,P=0,ee=0;ee<j.length;++ee){var fe=j[ee],L=fe.startQueryIndex,g=fe.endQueryIndex;fe.sum+=N[g]-N[L];var ne=v[L],X=v[g];X===ne?(fe.stats.gpuTime+=fe.sum/1e6,I(fe)):(fe.startQueryIndex=ne,fe.endQueryIndex=X,j[P++]=fe)}j.length=P}}return{beginQuery:S,endQuery:G,pushScopeStats:D,update:T,getNumPendingQueries:function(){return E.length},clear:function(){s.push.apply(s,E);for(var P=0;P<s.length;P++)n.ext_disjoint_timer_query.deleteQueryEXT(s[P]);E.length=0,s.length=0},restore:function(){E.length=0,s.length=0}}},fc=16384,oc=256,sc=1024,uc=34962,nf="webglcontextlost",af="webglcontextrestored",ff=1,cc=2,lc=3;function of(e,n){for(var s=0;s<e.length;++s)if(e[s]===n)return s;return-1}function dc(e){var n=uo(e);if(!n)return null;var s=n.gl,x=s.getContextAttributes(),w=s.isContextLost(),E=co(s,n);if(!E)return null;var S=ao(),G=tc(),C=E.extensions,B=ic(s,C),M=ha(),I=s.drawingBufferWidth,j=s.drawingBufferHeight,D={tick:0,time:0,viewportWidth:I,viewportHeight:j,framebufferWidth:I,framebufferHeight:j,drawingBufferWidth:I,drawingBufferHeight:j,pixelRatio:n.pixelRatio},N={},v={elements:null,primitive:4,count:-1,offset:0,instances:-1},T=Zo(s,C),P=hs(s,G,n,Z),ee=ws(s,C,P,G),O=wu(s,C,T,G,P,ee,v);function Z(se){return O.destroyBuffer(se)}var Y=Cu(s,S,G,n),fe=nu(s,C,T,function(){ne.procs.poll()},D,G,n),L=au(s,C,T,G,n),g=Su(s,C,T,fe,L,G),ne=rc(s,S,C,T,P,ee,fe,g,N,O,Y,v,D,B,n),X=Fu(s,g,ne.procs.poll,D,x,C,T),F=ne.next,$=s.canvas,W=[],me=[],le=[],q=[n.onDestroy],J=null;function ue(){if(W.length===0){B&&B.update(),J=null;return}J=Zt.next(ue),$e();for(var se=W.length-1;se>=0;--se){var ye=W[se];ye&&ye(D,null,0)}s.flush(),B&&B.update()}function de(){!J&&W.length>0&&(J=Zt.next(ue))}function be(){J&&(Zt.cancel(ue),J=null)}function Le(se){se.preventDefault(),w=!0,be(),me.forEach(function(ye){ye()})}function Re(se){s.getError(),w=!1,E.restore(),Y.restore(),P.restore(),fe.restore(),L.restore(),g.restore(),O.restore(),B&&B.restore(),ne.procs.refresh(),de(),le.forEach(function(ye){ye()})}$&&($.addEventListener(nf,Le,!1),$.addEventListener(af,Re,!1));function Ee(){W.length=0,be(),$&&($.removeEventListener(nf,Le),$.removeEventListener(af,Re)),Y.clear(),g.clear(),L.clear(),O.clear(),fe.clear(),ee.clear(),P.clear(),B&&B.clear(),q.forEach(function(se){se()})}function Ie(se){a(!!se,"invalid args to regl({...})"),a.type(se,"object","invalid args to regl({...})");function ye(p){var d=ce({},p);delete d.uniforms,delete d.attributes,delete d.context,delete d.vao,"stencil"in d&&d.stencil.op&&(d.stencil.opBack=d.stencil.opFront=d.stencil.op,delete d.stencil.op);function l(_){if(_ in d){var t=d[_];delete d[_],Object.keys(t).forEach(function(u){d[_+"."+u]=t[u]})}}return l("blend"),l("depth"),l("cull"),l("stencil"),l("polygonOffset"),l("scissor"),l("sample"),"vao"in p&&(d.vao=p.vao),d}function Ae(p,d){var l={},_={};return Object.keys(p).forEach(function(t){var u=p[t];if(Ke.isDynamic(u)){_[t]=Ke.unbox(u,t);return}else if(d&&Array.isArray(u)){for(var o=0;o<u.length;++o)if(Ke.isDynamic(u[o])){_[t]=Ke.unbox(u,t);return}}l[t]=u}),{dynamic:_,static:l}}var Fe=Ae(se.context||{},!0),fr=Ae(se.uniforms||{},!0),Gr=Ae(se.attributes||{},!1),f=Ae(ye(se),!1),A={gpuTime:0,cpuTime:0,count:0},y=ne.compile(f,Gr,fr,Fe,A),te=y.draw,_e=y.batch,i=y.scope,r=[];function c(p){for(;r.length<p;)r.push(null);return r}function h(p,d){var l;if(w&&a.raise("context lost"),typeof p=="function")return i.call(this,null,p,0);if(typeof d=="function")if(typeof p=="number")for(l=0;l<p;++l)i.call(this,null,d,l);else if(Array.isArray(p))for(l=0;l<p.length;++l)i.call(this,p[l],d,l);else return i.call(this,p,d,0);else if(typeof p=="number"){if(p>0)return _e.call(this,c(p|0),p|0)}else if(Array.isArray(p)){if(p.length)return _e.call(this,p,p.length)}else return te.call(this,p)}return ce(h,{stats:A,destroy:function(){y.destroy()}})}var we=g.setFBO=Ie({framebuffer:Ke.define.call(null,ff,"framebuffer")});function Be(se,ye){var Ae=0;ne.procs.poll();var Fe=ye.color;Fe&&(s.clearColor(+Fe[0]||0,+Fe[1]||0,+Fe[2]||0,+Fe[3]||0),Ae|=fc),"depth"in ye&&(s.clearDepth(+ye.depth),Ae|=oc),"stencil"in ye&&(s.clearStencil(ye.stencil|0),Ae|=sc),a(!!Ae,"called regl.clear with no buffer specified"),s.clear(Ae)}function ke(se){if(a(typeof se=="object"&&se,"regl.clear() takes an object as input"),"framebuffer"in se)if(se.framebuffer&&se.framebuffer_reglType==="framebufferCube")for(var ye=0;ye<6;++ye)we(ce({framebuffer:se.framebuffer.faces[ye]},se),Be);else we(se,Be);else Be(null,se)}function Me(se){a.type(se,"function","regl.frame() callback must be a function"),W.push(se);function ye(){var Ae=of(W,se);a(Ae>=0,"cannot cancel a frame twice");function Fe(){var fr=of(W,Fe);W[fr]=W[W.length-1],W.length-=1,W.length<=0&&be()}W[Ae]=Fe}return de(),{cancel:ye}}function je(){var se=F.viewport,ye=F.scissor_box;se[0]=se[1]=ye[0]=ye[1]=0,D.viewportWidth=D.framebufferWidth=D.drawingBufferWidth=se[2]=ye[2]=s.drawingBufferWidth,D.viewportHeight=D.framebufferHeight=D.drawingBufferHeight=se[3]=ye[3]=s.drawingBufferHeight}function $e(){D.tick+=1,D.time=ve(),je(),ne.procs.poll()}function De(){fe.refresh(),je(),ne.procs.refresh(),B&&B.update()}function ve(){return(ha()-M)/1e3}De();function We(se,ye){a.type(ye,"function","listener callback must be a function");var Ae;switch(se){case"frame":return Me(ye);case"lost":Ae=me;break;case"restore":Ae=le;break;case"destroy":Ae=q;break;default:a.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ae.push(ye),{cancel:function(){for(var Fe=0;Fe<Ae.length;++Fe)if(Ae[Fe]===ye){Ae[Fe]=Ae[Ae.length-1],Ae.pop();return}}}}var Te=ce(Ie,{clear:ke,prop:Ke.define.bind(null,ff),context:Ke.define.bind(null,cc),this:Ke.define.bind(null,lc),draw:Ie({}),buffer:function(se){return P.create(se,uc,!1,!1)},elements:function(se){return ee.create(se,!1)},texture:fe.create2D,cube:fe.createCube,renderbuffer:L.create,framebuffer:g.create,framebufferCube:g.createCube,vao:O.createVAO,attributes:x,frame:Me,on:We,limits:T,hasExtension:function(se){return T.extensions.indexOf(se.toLowerCase())>=0},read:X,destroy:Ee,_gl:s,_refresh:De,poll:function(){$e(),B&&B.update()},now:ve,stats:G});return n.onDone(null,Te),Te}return dc})}),Lc=wc});function ht(he,k,K){return he+K*(k-he)}function br(he,k){return~~(Math.random()*(k-he+1))+he}function Qn(he){let k=Math.sqrt(Math.pow(he.x,2)+Math.pow(he.y,2));return{x:he.x/k,y:he.y/k}}function lf(he,k){return{x:he.x*k,y:he.y*k}}function df(he,k){return Math.sqrt(Math.pow(k.x-he.x,2)+Math.pow(k.y-he.y,2))}function mf(he,k){return{x:he.x+k.x,y:he.y+k.y}}function hf(he){return new Promise(k=>{let K=new Image;return K.crossOrigin="anonymous",K.src=he,K.onload=()=>k(Object.assign(K)),K})}var vf=class{constructor(k){this._domBody=k,this._domBody.addEventListener("mousemove",this.OnMouseMove.bind(this))}SetConfig(k){console.log("ONLOAD"),this._config=k,this._config.elements.forEach(K=>{K.dom=this._domBody.querySelector(K.id)}),this._recordOffsetX=0,this._recordOffsetY=0,this.StartInverval()}OnMouseMove(k){let K=window.innerWidth,ce=window.innerHeight,ge=k.clientX/K,Ve=k.clientY/ce;this._targetOffsetX=.5-ge,this._targetOffsetY=.5-Ve}UpdateProcess(){Math.abs(this._targetOffsetX-this._recordOffsetX)+Math.abs(this._recordOffsetY-this._targetOffsetY)<.01||(this._recordOffsetX=ht(this._recordOffsetX,this._targetOffsetX,this._config.lerp),this._recordOffsetY=ht(this._recordOffsetY,this._targetOffsetY,this._config.lerp),isNaN(this._recordOffsetY)&&(this._recordOffsetY=0),isNaN(this._recordOffsetX)&&(this._recordOffsetX=0),this.Translate(this._recordOffsetX,this._recordOffsetY))}Translate(k,K){this._config.elements.forEach(ce=>{let ge=k*this._config.strength*ce.depth_level,Ve=K*this._config.strength*ce.depth_level,Pe=`translate(${ge}px, ${Ve}px)`;ce.dom!=null&&(ce.dom.style.transform=Pe)})}StartInverval(){this._intervalFunc=setInterval(this.UpdateProcess.bind(this),1e3/60)}Dispose(){this._intervalFunc!=null&&clearInterval(this._intervalFunc)}},pf=vf;var _f=class{constructor(k){this.delta=.02,this._tick=0,this._fps=1e3/60,this.maxBubbleSize=10,this.IsProgramValid=!1,this._canvasDom=k,this.IsProgramValid=this._canvasDom!=null,this.IsProgramValid&&(this._context=this._canvasDom.getContext("2d"),window.addEventListener("resize",()=>{this.SetCanvasSize()}),this.SetCanvasSize())}Play(k,K,ce){if(!!this.IsProgramValid){this.bubbles=[],this.speed=K,this.bubbleNum=k,this.SetDireciton(ce),this._intervalFunc=setInterval(this.UpdateProcess.bind(this),this._fps);for(let ge=0;ge<k;ge++)this.SpawnBubble(!0)}}SetDireciton(k){this.direction=Qn(k),this.spawnPosSetting=this.FindStartPos()}Stop(){this._intervalFunc!=null&&clearInterval(this._intervalFunc)}UpdateProcess(){this._context.clearRect(0,0,this._canvasDom.width,this._canvasDom.height),this.ProcessBubbleMoves()}ProcessBubbleMoves(){let k=this.bubbles.length;for(let K=k-1;K>=0;K--)this.DrawBubble(this.bubbles[K]),this.CheckBubbleDistReach(this.bubbles[K])&&this.bubbles.splice(K,1);k<this.bubbleNum&&this.SpawnBubble(),this._tick+=this._fps*.001}SpawnBubble(k=!1){let K={};K.Opacity=br(.1,.7),K.Radius=br(2,this.maxBubbleSize);let ce=this.speed*.2;K.SpeedOffset=br(ce,ce),k||K.Opacity<.2||K.Radius<this.maxBubbleSize*.7?K.StartPoint=this.GetRandomFullScreenPos():K.StartPoint={x:br(this.spawnPosSetting.WidthRange.x,this.spawnPosSetting.WidthRange.y),y:this.spawnPosSetting.StartHeight};let ge=this.screenWidth*.2,Ve=br(K.StartPoint.x-ge,K.StartPoint.x+ge);K.EndPoint={x:Ve,y:this.spawnPosSetting.EndHeight},K.CurrentEndPoint=K.EndPoint,K.CurrentPoint=K.StartPoint,K.CurrentOpacity=0,this.bubbles.push(K)}DrawBubble(k){this._context.beginPath();let K=k.EndPoint.x+Math.sin(this._tick+k.SpeedOffset)*1;k.CurrentEndPoint.x=K;let ce={x:k.CurrentEndPoint.x-k.CurrentPoint.x,y:k.CurrentEndPoint.y-k.CurrentPoint.y};k.Direction=Qn(ce);let ge=lf(k.Direction,(k.SpeedOffset+this.speed)*this.delta);k.CurrentPoint=mf(k.CurrentPoint,ge),k.CurrentOpacity=ht(k.CurrentOpacity,k.Opacity,.03);var Ve=0,Pe=2*Math.PI,Se=!1;this._context.arc(k.CurrentPoint.x,k.CurrentPoint.y,k.Radius,Ve,Pe,Se),this._context.fillStyle=`rgba(245, 225, 5, ${k.CurrentOpacity})`,this._context.fill()}CheckBubbleDistReach(k){return df(k.CurrentPoint,k.CurrentEndPoint)<10}FindStartPos(){let k={};if(this.direction==null)return k;k.WidthRange={x:-this.maxBubbleSize,y:this.screenWidth+this.maxBubbleSize};let K=this.maxBubbleSize*2;return this.direction.y>0&&(k.StartHeight=this.screenHeight+K,k.EndHeight=-K),this.direction.y<=0&&(k.StartHeight=-K,k.EndHeight=this.screenHeight+K),k}GetRandomFullScreenPos(){return{x:br(0,this.screenWidth),y:br(0,this.screenHeight)}}SetCanvasSize(){this._canvasDom.width=window.innerWidth,this._canvasDom.height=window.innerHeight,this.screenHeight=this._canvasDom.offsetHeight,this.screenWidth=this._canvasDom.offsetWidth,this.spawnPosSetting=this.FindStartPos()}},bf=_f;var yf=class{constructor(k){this.IsProgramValid=!1,this._canvasDom=document.querySelector(k),this.IsProgramValid=this._canvasDom!=null,this.IsProgramValid&&(this._context=this._canvasDom.getContext("2d"),this.RegisterDomEvent(),this.SetCanvasSize())}RegisterDomEvent(){window.addEventListener("resize",()=>{this.SetCanvasSize()})}SetCanvasSize(){this.SetCanvasToSceenSize(this._canvasDom),this.screenHeight=window.innerHeight,this.screenWidth=window.innerWidth}SetCanvasToSceenSize(k){k.width=window.innerWidth,k.height=window.innerHeight}},Ef=yf;var xf=class{async PrepareREGLShader(k,K,ce){let ge=fetch(ce,{method:"GET"}),Ve=fetch(K,{method:"GET"});Promise.all([Ve,ge]).then(Pe=>Promise.all([Pe[0].text(),Pe[1].text()])).then(Pe=>({vertex_shader:Pe[0],fragment_shader:Pe[1]}))}},Af=xf;var Oc=Promise.resolve().then(()=>xc(Tf())),Sf=class extends Ef{constructor(k,K,ce,ge){super(k);this.width=1024,this.height=750,this.slideEffectHelper=new Af,this.IsProgramValid&&(this.CreatREGL(K,ce,ge),this.LoadImage())}async CreatREGL(k,K,ce){let ge=await Oc;this.webglDom=document.querySelector(k),this.reglCanvas=ge.default(this.webglDom),this.slideEffectHelper.PrepareREGLShader(this.reglCanvas,K,ce),super.SetCanvasToSceenSize(this.webglDom)}async LoadImage(){let k="./image/ADP9_Clone/Th06Main.jpg";this.mainImage=await hf(k),this.SetImageToCenter(this.mainImage,this.width,this.height)}SetImageToCenter(k,K,ce){let ge=this.screenWidth*.5-K*.5,Ve=this.screenHeight*.5-ce*.5;this._context.drawImage(k,ge,Ve,K,ce)}SetCanvasSize(){super.SetCanvasSize(),!(!this.IsProgramValid||this.webglDom==null)&&(super.SetCanvasToSceenSize(this.webglDom),this.mainImage!=null&&this.SetImageToCenter(this.mainImage,this.width,this.height))}},gf=Sf;window.onload=()=>{let he=new pf(document.querySelector("body"));fetch("./Dataset/parallel_setting.json").then(function(Ve){return Ve.json()}).then(function(Ve){he.SetConfig(Ve)});let k=new bf(document.querySelector("#webgl_canvas"));if(k.IsProgramValid){let Ve=document.querySelector("#particle_count"),Pe=document.querySelector("#particle_speed"),Se=document.querySelector("#particle_d_invert");Ve.addEventListener("change",Fr=>{k.bubbleNum=parseInt(Fr.target.value)}),Pe.addEventListener("change",Fr=>{k.speed=parseInt(Fr.target.value)}),Se.addEventListener("change",Fr=>{k.SetDireciton({x:0,y:Se.checked?-1:1})});let sr={x:0,y:Se.checked?-1:1};k.Play(parseInt(Ve.value),parseInt(Pe.value),sr)}let K="./glsl/simple_texture.vert",ce="./glsl/slide_effect_ad6.frag",ge=new gf(".adp6_canvas_2d",".adp6_canvas_webgl",K,ce)};
