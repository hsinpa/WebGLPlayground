<html>
<head></head>

<body>
    <p>REGL Texture Sample</p>

    <canvas id="webgl" style="width: 45rem; height: 23rem;">

    </canvas>
</body>

<script src="library/regl.min.js"></script>

<script>
    var simpleFragPros = fetch("./glsl/simple_texture.frag", {method: 'GET'});
    var simpleVertPros = fetch("./glsl/simple_texture.vert", {method: 'GET'});

    var image = new Promise(resolve => {
                    const im = new Image();
                    im.crossOrigin = "anonymous";
                    im.src =
                        "./image/BB_rank.PNG";
                    im.onload = () => resolve(Object.assign(im, { style: "max-width:200px" }));
                });

    let containerR = document.getElementById("webgl");    
    resizeCanvas(containerR);

    const regl = createREGL(containerR);

    const DrawTexturePrepareShader = function() {
        //Prepare 
        Promise.all([simpleVertPros, simpleFragPros, image])
        .then( responses =>
            Promise.all(
                [responses[0].text(), responses[1].text(), responses[2]]
            )
        ).then((values) => {
            DrawTextureWithShader(values[0], values[1], values[2]);
        });
    }

    var DrawTextureWithShader = function(vert, frag, img) {
        // This clears the color buffer to black and the depth buffer to 1
        regl.clear({
        color: [0, 0, 0, 1],
        depth: 1
        })

        // In regl, draw operations are specified declaratively using. Each JSON
        // command is a complete description of all state. This removes the need to
        // .bind() things like buffers or shaders. All the boilerplate of setting up
        // and tearing down state is automated.
        regl( {
        // In a draw call, we can pass the shader source code to regl
        frag: frag,

        vert: vert,

        attributes: {
            a_position: [
                [-1, -1],
                [-1, 1],
                [1, 1],

                [-1, -1],
                [1, 1],
                [1, -1],
                    

                ]

        },

        uniforms: {
            color: [1, 0, 0, 1],
            texture: regl.texture({data:img, flipY: true})
        },

        count: 6,
        })()
    }

    function resizeCanvas(canvas) {
        var width = canvas.clientWidth;
        var height = canvas.clientHeight;
        if (canvas.width != width ||
            canvas.height != height) {
            canvas.width = width;
            canvas.height = height;
        }
    }


    DrawTexturePrepareShader();

</script>

</html>