<html>
<head></head>

<body>
    <p>REGL Texture Sample</p>

    <canvas id="webgl">

    </canvas>
</body>

<script src="library/regl.min.js"></script>

<script>
    var simpleFragPros = fetch("./glsl/simple_texture.frag", {method: 'GET'});
    var simpleVertPros = fetch("./glsl/simple_texture.vert", {method: 'GET'});

    var image = new Promise(resolve => {
                    const im = new Image();
                    im.crossOrigin = "anonymous";
                    im.src =
                        "./image/BB_rank.PNG";
                    im.onload = () => resolve(Object.assign(im, { style: "max-width:200px" }));
                });

    let containerR = document.getElementById("webgl");
    const regl = createREGL(containerR);

    const DrawTexturePrepareShader = function() {
        //Prepare 
        Promise.all([simpleVertPros, simpleFragPros, image])
        .then( responses =>
            Promise.all(
                [responses[0].text(), responses[1].text(), responses[2]]
            )
        ).then((values) => {
            DrawTextureWithShader(values[0], values[1], values[2]);
        });
    }

    var DrawTextureWithShader = function(vert, frag, img) {
        // This clears the color buffer to black and the depth buffer to 1
        regl.clear({
        color: [0, 0, 0, 1],
        depth: 1
        })

        // In regl, draw operations are specified declaratively using. Each JSON
        // command is a complete description of all state. This removes the need to
        // .bind() things like buffers or shaders. All the boilerplate of setting up
        // and tearing down state is automated.
        regl( {
        // In a draw call, we can pass the shader source code to regl
        frag: frag,

        vert: vert,

        attributes: {
            position: [-2, 0, 0, -2, 2, 2]
        },

        uniforms: {
            texture: regl.texture(img)
        },

        count: 3
        })()
    }

    DrawTexturePrepareShader();

</script>

</html>